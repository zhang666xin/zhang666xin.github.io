<!--
	作者：Sariay
	时间：2018-09-25
	描述：There may be a bug, but don't worry, QiLing(器灵) says that it can work normally!
-->


	<!DOCTYPE html>
	<html>
		

<head>
	<title>折柳叶轻吹</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="apple-mobile-web-app-title" content="Amaze UI" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <meta name="author" content="Mr.zx">
    <meta name="keywords" content="" />
    <meta name="description" content="你说旧梦已碎，解不开过往心结。" />
   	<!-- css -->
	<link rel="stylesheet" href="/css/style.css">

	<!-- favicon -->
	<link href="/img/favicon.ico" rel="Shortcut Icon" type="image/ico">
	
	<!-- font-awesome -->
	<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
	<body>	
		<!--Preloader-->
<div id="preloader">
	<div id="status">
		<img alt="PRELOADER" src="/img/logo.png">
	</div>
</div>
<!--Preloader end-->

<!-- header -->

	<header id="header-bg-2">

	
		<div id="cd-logo"><a href="/"><img src="/img/logo.png" alt="Logo"></a></div>
	
	
	<!-- motto or description -->
		
 		<p class="motto">记录生活美</p>
	
	
	<!-- current page name or title -->
	
		
		
			
			<p class=page-name>当前文章&nbsp;:&nbsp;《》</p>
			
		
	
          
   <!-- others: such as change-bg, time... -->
   <style>
	.page-name-other {
		color: #000000;
		text-align: center;
		font-size: 20px;
		line-height: 1.4em;
		font-family: "KaiTi", "STXingkai", "Source Sans Pro", "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", FreeSans, Arimo, "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", FontAwesome, sans-serif;
		margin: 100px 20px 0 20px;
	}

	.page-name-other p{
		margin-bottom: 150px;
	}  
   </style>
   
   <div class="page-name-other">
		<p>
			<span>像风吹了八万里，不问归期。</span>
			<span>记录生活，记录美！   ---Mr.zx</span>
		</p>
		<p>
			3/1/2019  
			<style type="text/css">
	header:after {
		content: '';
		position: relative;
		top: 0;
		left: 0;
		height: 100%;
		width: 100%;
		background: #222222;
		opacity: .5;
		z-index: -1;
	}
	
	.change-header-bg{
		font-style: normal;
	}
	.change-header-bg i{
		text-align: center;
		cursor: pointer;
		pointer-events: bounding-box;
	}
	@media(max-width:512px) {
		.change-header-bg {
			display: none;
			visibility: hidden;
		}
	}
	
</style>

<script type="text/javascript">
	function changeHeaderBg(){
		var random_bg = Math.floor(Math.random() * 109 + 1);
		var bg = 'url(https://zhang666xin.github.io/Random-img/' + random_bg + '.jpg)';
		$("#header-bg-2").css("background-image", bg);
	}
</script>

<span class="change-header-bg">
	——&nbsp;<i  class="fa fa-camera-retro" onclick="changeHeaderBg()"></i>	
</span>
		</p>	
		
    </div>	
</header>

<!-- nav -->
<div id="cd-nav">
	<a href="#0" title="menu" class="cd-nav-trigger"><span></span></a>

	<nav id="cd-main-nav">
		<ul>
			
      		<li class="fa fa-/">
           		<a href="/" title="主页">主页</a>	
      		</li>
    		
      		<li class="fa fa-/archives">
           		<a href="/archives" title="归档">归档</a>	
      		</li>
    		
      		<li class="fa fa-/categories">
           		<a href="/categories" title="分类">分类</a>	
      		</li>
    		
      		<li class="fa fa-/tags">
           		<a href="/tags" title="标签">标签</a>	
      		</li>
    		
      		<li class="fa fa-/about">
           		<a href="/about" title="关于">关于</a>	
      		</li>
    		
      		<li class="fa fa-/gallery">
           		<a href="/gallery" title="相册">相册</a>	
      		</li>
    		
    		
        	
            	<li class="fa fa-/search"><a href="javascript:;" class="popup-trigger" title="Search">搜索</a></li>
        	
		</ul>
	</nav>
</div>

		<!--main-->
		<main> 
		<div class="page-container">
		<!-- content srart -->
<div class="am-g am-g-fixed blog-fixed blog-content">
	<div class="am-u-md-8 am-u-sm-12">

		<article class="am-article blog-article-p">

			<div class="am-article-hd">
				


				<h1 class="am-article-title blog-text-center">
					
					
				</h1>

				<p class="am-article-meta blog-text-center">
					<span>
						<i class="fa fa-clock-o"></i> 
						<a href="/2019/03/01/深度学习入门笔记/" itemprop="url">
	<time datetime="2019-03-01T14:40:31.682Z" itemprop="datePublished">
  		2019-03-01
  </time>
</a>    
&nbsp;
					</span>
					
					<span>						
						
					</span>
				</p>
			</div>

			<div class="am-article-bd">
				<div class="content" id="post-content">
					
						<pre><code>title: 深度学习入门
cover: /img/13.jpg
categories: 深度学习
tags: 深度学习
</code></pre><h1 id="深度学习入门："><a href="#深度学习入门：" class="headerlink" title="深度学习入门："></a><strong>深度学习入门：</strong></h1><h4 id="1、深度学习介绍："><a href="#1、深度学习介绍：" class="headerlink" title="1、深度学习介绍："></a><strong>1、深度学习介绍：</strong></h4><p>1）深度学习与机器学习的区别：</p>
<p>a、特征提取方面：机器学习的特征工程是靠手动完成的，需要大量领域专业知识，而深度学习通常由多个层组成，将更简单的模型组合在一起，将数据从一个层传递到另一个层来构建更复杂的模型，通过训练大量数据自动得出模型，不需要人工特征提取环节</p>
<p><img src="D:\Machine learning\深度学习image\深度学习介绍.png" alt=""></p>
<p>b、数据量和计算性能要求：</p>
<p><img src="D:\Machine learning\深度学习image\深度学习介绍1.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\深度学习介绍2.png" alt=""></p>
<p>c、算法代表：机器学习：朴素贝叶斯、决策树等 ，深度学习：神经网络</p>
<h4 id="2、TensorFlow框架的使用："><a href="#2、TensorFlow框架的使用：" class="headerlink" title="2、TensorFlow框架的使用："></a><strong>2、TensorFlow框架的使用：</strong></h4><p>1）TensorFlow的结构：两个阶段组成：构建图阶段和执行图阶段</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#TensorFlow加法运算</span>
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf

a_t<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
b_t<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
c_t<span class="token operator">=</span>a_t<span class="token operator">+</span>b_t
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tensorflow加法运算的结果：\n'</span><span class="token punctuation">,</span>c_t<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#开启会话，目的看到具体的值</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    c_t_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>c_t<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c_t_value:\n'</span><span class="token punctuation">,</span>c_t_value<span class="token punctuation">)</span>

结果如下：
tensorflow加法运算的结果：
 Tensor<span class="token punctuation">(</span><span class="token string">"add:0"</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int32<span class="token punctuation">)</span>
<span class="token number">2019</span><span class="token operator">-</span><span class="token number">02</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">02</span><span class="token punctuation">:</span><span class="token number">40.769806</span><span class="token punctuation">:</span> I tensorflow<span class="token operator">/</span>core<span class="token operator">/</span>platform<span class="token operator">/</span>cpu_feature_guard<span class="token punctuation">.</span>cc<span class="token punctuation">:</span><span class="token number">141</span><span class="token punctuation">]</span> Your CPU supports instructions that this TensorFlow binary was <span class="token operator">not</span> compiled to use<span class="token punctuation">:</span> AVX2
c_t_value<span class="token punctuation">:</span>
 <span class="token number">5</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>若想去掉红字警告，可在开头加上：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>2）TensorFlow的各个组件：</p>
<h5 id="图：定义数据和操作的步骤"><a href="#图：定义数据和操作的步骤" class="headerlink" title="图：定义数据和操作的步骤"></a><strong>图：定义数据和操作的步骤</strong></h5><p>a、图结构：数据（Tensor对象）+操作（Operation对象）</p>
<p>b、图相关操作：默认图、自定义图</p>
<p>b-1：默认图：通常TensorFlow会默认帮我们创建一张图</p>
<p>查看默认图的两种方法：</p>
<p>●tf.get_default_graph()：将操作添加到默认图形中，直接创建OP即可</p>
<p>●op、sess都含有graph属性（.graph），默认都在一张图中</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

a_t<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
b_t<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
c_t<span class="token operator">=</span>a_t<span class="token operator">+</span>b_t
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tensorflow加法运算的结果：\n'</span><span class="token punctuation">,</span>c_t<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#查看默认图</span>
<span class="token comment" spellcheck="true">#方法一：调用方法</span>
default_g<span class="token operator">=</span>tf<span class="token punctuation">.</span>get_default_graph<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'default_g：\n'</span><span class="token punctuation">,</span>default_g<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#方法二：查看属性</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a_t的图属性：\n'</span><span class="token punctuation">,</span>a_t<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c_t的图属性：\n'</span><span class="token punctuation">,</span>c_t<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#开启会话，目的看到具体的值</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    c_t_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>c_t<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c_t_value:\n'</span><span class="token punctuation">,</span>c_t_value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'sess的图属性：\n'</span><span class="token punctuation">,</span>sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>

结果如下：
tensorflow加法运算的结果：
 Tensor<span class="token punctuation">(</span><span class="token string">"add:0"</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int32<span class="token punctuation">)</span>
default_g：
 <span class="token operator">&lt;</span>tensorflow<span class="token punctuation">.</span>python<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>Graph object at <span class="token number">0x00000188DB68D278</span><span class="token operator">></span>
a_t的图属性：
 <span class="token operator">&lt;</span>tensorflow<span class="token punctuation">.</span>python<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>Graph object at <span class="token number">0x00000188DB68D278</span><span class="token operator">></span>
c_t的图属性：
 <span class="token operator">&lt;</span>tensorflow<span class="token punctuation">.</span>python<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>Graph object at <span class="token number">0x00000188DB68D278</span><span class="token operator">></span>
c_t_value<span class="token punctuation">:</span>
 <span class="token number">5</span>
sess的图属性：
 <span class="token operator">&lt;</span>tensorflow<span class="token punctuation">.</span>python<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>Graph object at <span class="token number">0x00000188DB68D278</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>b-2：自定义图：可以通过tf.Graph()自定义创建图（new_g=tf.Graph()），如果要在这张图中创建OP，典型用法是使用tf.Graph.as_default()上下文管理器（with new_g.as_default():   定义数据和操作）</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#自定义图</span>
new_g<span class="token operator">=</span>tf<span class="token punctuation">.</span>Graph<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#在自己的图中定义数据和操作</span>
<span class="token keyword">with</span> new_g<span class="token punctuation">.</span>as_default<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a_new<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
    b_new<span class="token operator">=</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
    c_new<span class="token operator">=</span>a_new<span class="token operator">+</span>b_new
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c_new:\n'</span><span class="token punctuation">,</span>c_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a_new的图属性：\n'</span><span class="token punctuation">,</span>a_new<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c_new的图属性：\n'</span><span class="token punctuation">,</span>c_new<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span>graph<span class="token operator">=</span>new_g<span class="token punctuation">)</span> <span class="token keyword">as</span> new_sess<span class="token punctuation">:</span>
    c_new_value<span class="token operator">=</span>new_sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>c_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c_new_value:\n'</span><span class="token punctuation">,</span>c_new_value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'new_sess的图属性：\n'</span><span class="token punctuation">,</span> new_sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>

结果如下：
c_new<span class="token punctuation">:</span>
 Tensor<span class="token punctuation">(</span><span class="token string">"add:0"</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>int32<span class="token punctuation">)</span>
a_new的图属性：
 <span class="token operator">&lt;</span>tensorflow<span class="token punctuation">.</span>python<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>Graph object at <span class="token number">0x00000107E096C438</span><span class="token operator">></span>
c_new的图属性：
 <span class="token operator">&lt;</span>tensorflow<span class="token punctuation">.</span>python<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>Graph object at <span class="token number">0x00000107E096C438</span><span class="token operator">></span>
c_new_value<span class="token punctuation">:</span>
 <span class="token number">50</span>
new_sess的图属性：
 <span class="token operator">&lt;</span>tensorflow<span class="token punctuation">.</span>python<span class="token punctuation">.</span>framework<span class="token punctuation">.</span>ops<span class="token punctuation">.</span>Graph object at <span class="token number">0x00000107E096C438</span><span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>c、TensorBoard：可视化学习</p>
<p>c-1：步骤：</p>
<p>数据序列化 生成events文件：<strong>tf.summary.FileWriter(path,graph=sess.graph)</strong> </p>
<p>启动TensorBoard：打开终端，输入 tensorboard –logdir=‘path路径‘，然后在浏览器输入127.0.0.1:6006</p>
<pre class="line-numbers language-python"><code class="language-python"> <span class="token comment" spellcheck="true"># 将图写入本地生成events文件</span>
 tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./tmp/summary'</span><span class="token punctuation">,</span> graph<span class="token operator">=</span>new_sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>c-2：tensorboard生成的文件名乱码问题：是因为计算机名字为中文，改成英文就可以了 </p>
<p>d、OP（operation）：</p>
<p>d-1：常见OP：</p>
<p><img src="D:\Machine learning\深度学习image\OP.png" alt=""></p>
<p>d-2：操作函数与操作对象：</p>
<p>如tf.constant(输入Tensor对象)  tf.add(Tensor对象1,Tensor对象2) 就是操作函数，就是去创建常数的操作</p>
<p>如Const就是操作对象（输出的还是Tensor对象）</p>
<p>执行完操作函数之后就会生成操作对象</p>
<p><img src="D:\Machine learning\深度学习image\const.png" alt=""></p>
<p>e、指令名称：一张图只有一个命名空间，默认的指令名称是Const，也可以自己修改</p>
<p>tf.constant(name=’xxx’)</p>
<p><img src="D:\Machine learning\深度学习image\指令名称.png" alt=""></p>
<h5 id="会话：调用各方资源，将定义好的数据和操作运行起来"><a href="#会话：调用各方资源，将定义好的数据和操作运行起来" class="headerlink" title="会话：调用各方资源，将定义好的数据和操作运行起来"></a><strong>会话：调用各方资源，将定义好的数据和操作运行起来</strong></h5><p>a-1、开启会话的两种方式：</p>
<p>●tf.Session：用于完整的程序当中</p>
<p>●tf.InteractiveSession：用于交互式上下文中的TensorFlow，如shell</p>
<pre><code>想在会话中（只能在会话中）快速查看具体的值：
将  c_new_value=new_sess.run(c_new)
    print(&#39;c_new_value:\n&#39;,c_new_value)
改为  print(&#39;c_new_value:\n&#39;,c_new.eval())
</code></pre><p>a-2：初始化会话时：</p>
<p><img src="D:\Machine learning\深度学习image\初始化会话.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\会话参数.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span>config<span class="token operator">=</span>tf<span class="token punctuation">.</span>ConfigProto<span class="token punctuation">(</span>allow_soft_placement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>log_device_placement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>

结果如下：
Device mapping<span class="token punctuation">:</span> no known devices<span class="token punctuation">.</span>
add<span class="token punctuation">:</span> <span class="token punctuation">(</span>Add<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">/</span>job<span class="token punctuation">:</span>localhost<span class="token operator">/</span>replica<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>task<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>device<span class="token punctuation">:</span>CPU<span class="token punctuation">:</span><span class="token number">0</span>
Const<span class="token punctuation">:</span> <span class="token punctuation">(</span>Const<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">/</span>job<span class="token punctuation">:</span>localhost<span class="token operator">/</span>replica<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>task<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>device<span class="token punctuation">:</span>CPU<span class="token punctuation">:</span><span class="token number">0</span>
Const_1<span class="token punctuation">:</span> <span class="token punctuation">(</span>Const<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">/</span>job<span class="token punctuation">:</span>localhost<span class="token operator">/</span>replica<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>task<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>device<span class="token punctuation">:</span>CPU<span class="token punctuation">:</span><span class="token number">0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以下两种方式都能开启会话，但我们一般常用上下文管理器，即第二种</p>
<p><img src="D:\Machine learning\深度学习image\开启会话.png" alt=""></p>
<p>a-3：</p>
<p><img src="D:\Machine learning\深度学习image\run.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#同时查看a_t、b_t、c_t</span>
abc<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>a_t<span class="token punctuation">,</span>b_t<span class="token punctuation">,</span>c_t<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'abc:\n'</span><span class="token punctuation">,</span>abc<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#同时查看a_t、b_t、c_t</span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>a_t<span class="token punctuation">,</span>b_t<span class="token punctuation">,</span>c_t<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'abc:\n'</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>

结果如下：
abc<span class="token punctuation">:</span>
 <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>

abc<span class="token punctuation">:</span>
 <span class="token number">2</span> <span class="token number">3</span> <span class="token number">5</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>a-3：feed操作：不知道具体的值，只是先赋予类型,run时候通过feed_dict指定参数</p>
<p><strong>a=tf.placeholder(tf.float32,shape=)</strong></p>
<p>在会话里面：</p>
<p><strong>sess.run(sun,feed_dict={a:3.0,b:4.0})</strong></p>
<p><img src="D:\Machine learning\深度学习image\feed.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#定义占位符</span>
a_ph<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
b_ph<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
c_ph<span class="token operator">=</span>tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a_ph<span class="token punctuation">,</span>b_ph<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#开启会话，目的看到具体的值</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span>config<span class="token operator">=</span>tf<span class="token punctuation">.</span>ConfigProto<span class="token punctuation">(</span>allow_soft_placement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>log_device_placement<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#运行placeholder</span>
    c_ph_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>c_ph<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>a_ph<span class="token punctuation">:</span><span class="token number">3.0</span><span class="token punctuation">,</span>b_ph<span class="token punctuation">:</span><span class="token number">4.0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c_ph_value：\n'</span><span class="token punctuation">,</span>c_ph_value<span class="token punctuation">)</span>

结果如下：
Device mapping<span class="token punctuation">:</span> no known devices<span class="token punctuation">.</span>
Add<span class="token punctuation">:</span> <span class="token punctuation">(</span>Add<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">/</span>job<span class="token punctuation">:</span>localhost<span class="token operator">/</span>replica<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>task<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>device<span class="token punctuation">:</span>CPU<span class="token punctuation">:</span><span class="token number">0</span>
Placeholder<span class="token punctuation">:</span> <span class="token punctuation">(</span>Placeholder<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">/</span>job<span class="token punctuation">:</span>localhost<span class="token operator">/</span>replica<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>task<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>device<span class="token punctuation">:</span>CPU<span class="token punctuation">:</span><span class="token number">0</span>
Placeholder_1<span class="token punctuation">:</span> <span class="token punctuation">(</span>Placeholder<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token operator">/</span>job<span class="token punctuation">:</span>localhost<span class="token operator">/</span>replica<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>task<span class="token punctuation">:</span><span class="token number">0</span><span class="token operator">/</span>device<span class="token punctuation">:</span>CPU<span class="token punctuation">:</span><span class="token number">0</span>
c_ph_value：
 <span class="token number">7.0</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="张量：数据（tensor）"><a href="#张量：数据（tensor）" class="headerlink" title="张量：数据（tensor）"></a><strong>张量：数据（tensor）</strong></h5><p>a、张量就是一个n维数组，有两个重要的属性</p>
<p>●type：数据类型</p>
<p>●shape：形状（阶/维度）</p>
<p>b、张量的类型：</p>
<p><img src="D:\Machine learning\深度学习image\张量类型.png" alt=""></p>
<p>c、张量的阶：</p>
<p><img src="D:\Machine learning\深度学习image\张量的阶.png" alt=""></p>
<p>创建张量的时候，如果不指定类型：</p>
<p>默认  整形 tf.int32    浮点型 tf.float32</p>
<p>d、创建张量</p>
<p>创建固定值张量的指令：</p>
<p>tf.zeros(shape=[2,3,5],dtype=tf.float32,name=None)</p>
<p>tf.ones(shape=,dtype=tf.float32,name=None)</p>
<p>tf.constant(value,dtype=None,shape=None,name=’Const’)</p>
<p>创建随机张量的指令：</p>
<p>tf.random_normal(shape,mean=0.0,stddev=1.0,dtype=tf.float32,seed=None,name=None)  </p>
<p>mean是均值  stddev是标准差</p>
<p>查看：<strong>tf.zeros(shape,dtype=tf.float32,name=None).eval()</strong></p>
<p>e、张量的变换</p>
<p>e-1：类型改变：常用<strong>tf.cast(tensor,dtype=,name=None)</strong></p>
<p><img src="D:\Machine learning\深度学习image\类型改变.png" alt=""></p>
<p>e-2：形状修改：</p>
<p>静态形状：初始创建张量的形状</p>
<p>动态形状：</p>
<p>改变静态形状：只有在形状没有完全固定下来的情况下（没有定义dtype，若列数/行数已经确定，则列数/行数无法修改），使用<strong>tensor.set_shape(shape)</strong>     eg：a_t.set_shape([2,3])</p>
<p>改变动态形状：<strong>tf.reshape(tensor,shape)</strong>   可以改变已经确定了的形状，前后维数要一致</p>
<p>e-3：张量的数学运算：</p>
<p><a href="https://tensorflow.google.cn/api_docs/python/tf" target="_blank" rel="noopener">https://tensorflow.google.cn/api_docs/python/tf</a></p>
<h5 id="变量OP：存储模型参数"><a href="#变量OP：存储模型参数" class="headerlink" title="变量OP：存储模型参数"></a><strong>变量OP：存储模型参数</strong></h5><p>a、创建变量：</p>
<p><strong>tf.Variable(initial_value=None,trainable=True,collections=None,name=None)</strong> </p>
<p>●initial_value：初始化的值</p>
<p>●trainable：是否被训练</p>
<p>●collections：新变量将添加到列出的图的集合中collections，如果trainable是True变量也被添加到图形集合中</p>
<p><strong>注：变量必须要初始化，才能运行值</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#定义变量</span>
a<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">)</span>
c<span class="token operator">=</span>tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#初始化变量</span>
init<span class="token operator">=</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#运行初始化</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
    a_value<span class="token punctuation">,</span>b_value<span class="token punctuation">,</span>c_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"a_value:\n"</span><span class="token punctuation">,</span>a_value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"b_value:\n"</span><span class="token punctuation">,</span>b_value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"c_value:\n"</span><span class="token punctuation">,</span>c_value<span class="token punctuation">)</span>

结果如下：
a_value<span class="token punctuation">:</span>
 <span class="token number">50</span>
b_value<span class="token punctuation">:</span>
 <span class="token number">40</span>
c_value<span class="token punctuation">:</span>
 <span class="token number">90</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>b、修改变量的命名空间：</p>
<p><strong>tf.variable_scope()</strong> </p>
<pre class="line-numbers language-python"><code class="language-python">a<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a:\n'</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>

<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'my-scope'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a:\n'</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>

a<span class="token punctuation">:</span>
 <span class="token operator">&lt;</span>tf<span class="token punctuation">.</span>Variable <span class="token string">'Variable:0'</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> dtype<span class="token operator">=</span>int32_ref<span class="token operator">></span>
a<span class="token punctuation">:</span>
 <span class="token operator">&lt;</span>tf<span class="token punctuation">.</span>Variable <span class="token string">'my-scope/Variable:0'</span> shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span> dtype<span class="token operator">=</span>int32_ref<span class="token operator">></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#定义变量</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'my-scope'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'your_scope'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    c<span class="token operator">=</span>tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a:\n'</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'c:\n'</span><span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="节点（OP）：操作"><a href="#节点（OP）：操作" class="headerlink" title="节点（OP）：操作"></a><strong>节点（OP）：操作</strong></h5><p>3）API</p>
<p>基础API：</p>
<p>●tf.app：提供main函数的入口，可以定义脚本运行的flags</p>
<p>●tf.image：tensorflow的图像处理操作</p>
<p>●tf.gfile：文件操作函数</p>
<p>●tf.summary：生成统计日志，主要提供4种类型：audio、image、histogram、scalar</p>
<p>●tf.python_io：读取TFRecords文件</p>
<p>●tf.train：提供训练器，与tf.nn组合起来，实现一些网络的优化计算</p>
<p>●tf.nn：提供一些构建神经网络的底层函数，TensorFlow构建网络的核心模块，其中包含了添加各种层的函数，比如添加卷积层、池化层</p>
<p>高级API：</p>
<p>●tf.keras：快速构建模型</p>
<p>●tf.layers：基础组件的封装</p>
<p>●tf.contrib：提供计算图中的网络层、正则化、摘要操作，是构建计算图的高级操作</p>
<p>●tf.estimator：相当于Model+Training+Evaluate的合体</p>
<p>3）数据流图：Tensor（数据） + Flow（流动）</p>
<p><img src="D:\Machine learning\深度学习image\tensors_flowing.gif" alt=""></p>
<p>4）案例：用TensorFlow实现简单的线性回归</p>
<p>  100个样本     x  特征值 形状（100，1）   y_true  目标值 形状（100，1）  y_true=0.8*x+0.7</p>
<p>假设x和y之间满足：y=kx+b 则 （100，1）*（1，1）=（100，1）</p>
<p>API：</p>
<p>tf.matmul(x,w)  矩阵运算            tf.square(error)  平方        tf.reduce_mean(error)   均值</p>
<p><strong>梯度下降优化：tf.train.GradientDescentOptimizer(learning_rate)     返回的结果是梯度下降的优化器op</strong>  </p>
<p>●learning_rate：学习率，一般为0-1之间比较小的值</p>
<p>●method：minimize(loss)  最小化 </p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#1、准备数据</span>
x<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_true<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0.7</span>

<span class="token comment" spellcheck="true">#2、构建模型</span>
<span class="token comment" spellcheck="true">#定义模型参数 用变量</span>
weights<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bias<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_predict<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token operator">+</span>bias

<span class="token comment" spellcheck="true">#3、构造损失函数</span>
<span class="token comment" spellcheck="true">#计算均方误差</span>
error<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_predict<span class="token operator">-</span>y_true<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#4、优化损失</span>
optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>error<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#5、初始化变量</span>
init<span class="token operator">=</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#6、开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#初始化变量</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#查看初始化模型参数值后的值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练前模型参数为：权重为%f，偏置为%f 损失为%f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>weights<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bias<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>error<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#开始迭代训练</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第%d次训练后模型参数为：权重为%f，偏置为%f 损失为%f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>weights<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#print('训练后模型参数为：权重为%f，偏置为%f 损失为%f' % (weights.eval(),bias.eval(),error.eval()))</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>案例需要注意的地方：</strong></p>
<p>学习率的设置、步数的设置与梯度爆炸：</p>
<p>a、学习率越大，步数越小，可以训练到较好的结果，反之，也可以，但要适度，不能过大和过小</p>
<p>b、学习过大会出现梯度爆炸现象：在极端情况下，权重的值变得非常大，以至于溢出，导致NaN值，在深度神经网络中更容易出现</p>
<p>c、解决梯度爆炸问题：1重新设计网络  2调整学习率  3使用梯度截断（在训练过程中检查和限制梯度的大小）4使用激活函数 </p>
<p><strong>增加其他功能：</strong></p>
<p>a、增加变量显示：目的是在TensorBoard当中观察模型的参数、损失值等变量值的变化</p>
<p>步骤：创建事件文件–&gt;收集变量–&gt;合并变量—&gt;每次迭代运行一次合并变量—&gt;每次迭代将summary写入事件文件</p>
<p>a-1：收集变量：</p>
<p><strong>●tf.summary.scalar(name=’xxx’,tensor)             scalar标量                  收集对于损失函数和准确率等单值变量，name为变量的名字，tensor为值</strong>   </p>
<p><strong>●tf.summary.histogram(name=’xxx’,tensor)     histogram直方图     收集高维度的变量参数</strong></p>
<p><strong>●tf.summary.image(name=’xxx’,tensor)                                                 收集输入的图片张量能显示图片</strong></p>
<p> a-2：合并变量写入事件文件：</p>
<p>●merged=tf.summary.merge_all()</p>
<p>●运行合并：summary=sess.run(merged)   每次迭代都需运行</p>
<p>●添加：FileWriter.add_summary(summary,i)   i表示第几次的值</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os
os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true"># a_t=tf.constant(2)</span>
<span class="token comment" spellcheck="true"># b_t=tf.constant(3)</span>
<span class="token comment" spellcheck="true"># c_t=tf.add(a_t,b_t)</span>
<span class="token comment" spellcheck="true"># #定义占位符</span>
<span class="token comment" spellcheck="true"># a_ph=tf.placeholder(tf.float32)</span>
<span class="token comment" spellcheck="true"># b_ph=tf.placeholder(tf.float32)</span>
<span class="token comment" spellcheck="true"># c_ph=tf.add(a_ph,b_ph)</span>
<span class="token comment" spellcheck="true"># #开启会话，目的看到具体的值</span>
<span class="token comment" spellcheck="true"># with tf.Session(config=tf.ConfigProto(allow_soft_placement=True,log_device_placement=True)) as sess:</span>
<span class="token comment" spellcheck="true">#     #运行placeholder</span>
<span class="token comment" spellcheck="true">#     c_ph_value=sess.run(c_ph,feed_dict={a_ph:3.0,b_ph:4.0})</span>
<span class="token comment" spellcheck="true">#     print('c_ph_value：\n',c_ph_value)</span>
    <span class="token comment" spellcheck="true"># c_t_value=sess.run(c_t)</span>
    <span class="token comment" spellcheck="true"># #同时查看a_t、b_t、c_t</span>
    <span class="token comment" spellcheck="true"># a,b,c=sess.run([a_t,b_t,c_t])</span>
    <span class="token comment" spellcheck="true"># print('abc:\n',a,b,c)</span>
    <span class="token comment" spellcheck="true"># print('c_t_value:\n',c_t_value)</span>
    <span class="token comment" spellcheck="true"># print('sess的图属性：\n',sess.graph)</span>


<span class="token comment" spellcheck="true"># #自定义图</span>
<span class="token comment" spellcheck="true"># new_g=tf.Graph()</span>
<span class="token comment" spellcheck="true"># #在自己的图中定义数据和操作</span>
<span class="token comment" spellcheck="true"># with new_g.as_default():</span>
<span class="token comment" spellcheck="true">#     a_new=tf.constant(20)</span>
<span class="token comment" spellcheck="true">#     b_new=tf.constant(30)</span>
<span class="token comment" spellcheck="true">#     c_new=a_new+b_new</span>
<span class="token comment" spellcheck="true">#     print('c_new:\n',c_new)</span>
<span class="token comment" spellcheck="true">#     print('a_new的图属性：\n',a_new.graph)</span>
<span class="token comment" spellcheck="true">#     print('c_new的图属性：\n',c_new.graph)</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># #开启会话</span>
<span class="token comment" spellcheck="true"># with tf.Session(graph=new_g) as new_sess:</span>
<span class="token comment" spellcheck="true">#     c_new_value=new_sess.run(c_new)</span>
<span class="token comment" spellcheck="true">#     print('c_new_value:\n',c_new_value)</span>
<span class="token comment" spellcheck="true">#     print('new_sess的图属性：\n', new_sess.graph)</span>
<span class="token comment" spellcheck="true">#     # 将图写入本地生成events文件</span>
<span class="token comment" spellcheck="true">#     tf.summary.FileWriter('./tmp/summary', graph=new_sess.graph)</span>


<span class="token comment" spellcheck="true"># #定义变量</span>
<span class="token comment" spellcheck="true"># with tf.variable_scope('my-scope'):</span>
<span class="token comment" spellcheck="true">#     a=tf.Variable(initial_value=50)</span>
<span class="token comment" spellcheck="true"># with tf.variable_scope('your_scope'):</span>
<span class="token comment" spellcheck="true">#     c=tf.add(a,b)</span>
<span class="token comment" spellcheck="true"># print('a:\n',a)</span>
<span class="token comment" spellcheck="true"># print('c:\n',c)</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># #初始化变量</span>
<span class="token comment" spellcheck="true"># init=tf.global_variables_initializer()</span>
<span class="token comment" spellcheck="true"># #开启会话</span>
<span class="token comment" spellcheck="true"># with tf.Session() as sess:</span>
<span class="token comment" spellcheck="true">#     #运行初始化</span>
<span class="token comment" spellcheck="true">#     sess.run(init)</span>
<span class="token comment" spellcheck="true">#     a_value,b_value,c_value=sess.run([a,b,c])</span>
<span class="token comment" spellcheck="true">#     print("a_value:\n",a_value)</span>
<span class="token comment" spellcheck="true">#     print("b_value:\n",b_value)</span>
<span class="token comment" spellcheck="true">#     print("c_value:\n",c_value)</span>


<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#1、准备数据</span>
x<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_true<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0.7</span>

<span class="token comment" spellcheck="true">#2、构建模型</span>
<span class="token comment" spellcheck="true">#定义模型参数 用变量</span>
weights<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
bias<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_predict<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token operator">+</span>bias

<span class="token comment" spellcheck="true">#3、构造损失函数</span>
<span class="token comment" spellcheck="true">#计算均方误差</span>
error<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_predict<span class="token operator">-</span>y_true<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#4、优化损失</span>
optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>error<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#1-2:收集变量</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>histogram<span class="token punctuation">(</span><span class="token string">'weights'</span><span class="token punctuation">,</span>weights<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>histogram<span class="token punctuation">(</span><span class="token string">'bias'</span><span class="token punctuation">,</span>bias<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#1-3:合并变量</span>
merged<span class="token operator">=</span>tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>merge_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#5、初始化变量</span>
init<span class="token operator">=</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#6、开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#初始化变量</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#1-1、创建事件文件</span>
    file_writer<span class="token operator">=</span>tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./tmp/linear'</span><span class="token punctuation">,</span>graph<span class="token operator">=</span>sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">#查看初始化模型参数值后的值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练前模型参数为：权重为%f，偏置为%f 损失为%f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>weights<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bias<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>error<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#开始迭代训练</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>optimizer<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第%d次训练后模型参数为：权重为%f，偏置为%f 损失为%f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>weights<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#print('训练后模型参数为：权重为%f，偏置为%f 损失为%f' % (weights.eval(),bias.eval(),error.eval()))</span>
        <span class="token comment" spellcheck="true">#运行合并变量操作</span>
        summary<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>merged<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#将每次迭代后的变量写入事件文件</span>
        file_writer<span class="token punctuation">.</span>add_summary<span class="token punctuation">(</span>summary<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>结果如下：</p>
<p><img src="D:\Machine learning\深度学习image\变量显示.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\error.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\weights_bias.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\一维weight_bias.png" alt=""></p>
<p>b、增加命名空间：使代码结构更加清晰    with tf.variable_scope(‘lr_model’)：</p>
<pre class="line-numbers language-python"><code class="language-python">
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>结果如下：</p>
<p><img src="D:\Machine learning\深度学习image\18L}[$IE[EK4]E{4`97U7GS.png" alt=""></p>
<p>c、模型的保存与加载：</p>
<p><strong>tf.train.Saver(var_list=None,max_to_keep=5)  保存的文件格式是checkpoint文件</strong></p>
<p>●var_list：指定将要保存和还原的变量，它可以作为一个dict或一个列表传递</p>
<p>●max_to_keep：要保留的最近检查点文件的最大数量，创建新文件时，会删除较旧的文件，如果无或0，则保留所有检查点文件，默认是5（即保留最新的5个检查点文件）</p>
<p>步骤：实例化Saver[saver=tf.train.Saver(var_list=None,max_to_keep=5)  ]—&gt;保存saver.save(sess,path)—&gt;加载saver.restore(sess,path)</p>
<p>注：保存模型的时候，路径的文件夹必须是提前建好了的，而且必须给模型起名字，在加后缀ckpt</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'prepare_data'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#1、准备数据</span>
    x<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    y_true<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">0.7</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'create_model'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#2、构建模型</span>
    <span class="token comment" spellcheck="true">#定义模型参数 用变量</span>
    weights<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    bias<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    y_predict<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span>weights<span class="token punctuation">)</span><span class="token operator">+</span>bias
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'loss_function'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#3、构造损失函数</span>
    <span class="token comment" spellcheck="true">#计算均方误差</span>
    error<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_predict<span class="token operator">-</span>y_true<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'optimizer'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#4、优化损失</span>
    optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>error<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#1-2:收集变量</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span>error<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>histogram<span class="token punctuation">(</span><span class="token string">'weights'</span><span class="token punctuation">,</span>weights<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>histogram<span class="token punctuation">(</span><span class="token string">'bias'</span><span class="token punctuation">,</span>bias<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#1-3:合并变量</span>
merged<span class="token operator">=</span>tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>merge_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#创建Saver对象</span>
saver<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#5、初始化变量</span>
init<span class="token operator">=</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#6、开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#初始化变量</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#1-1、创建事件文件</span>
    file_writer<span class="token operator">=</span>tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./tmp/linear'</span><span class="token punctuation">,</span>graph<span class="token operator">=</span>sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">#查看初始化模型参数值后的值</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练前模型参数为：权重为%f，偏置为%f 损失为%f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>weights<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>bias<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>error<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># #开始迭代训练</span>
    <span class="token comment" spellcheck="true"># for i in range(100):</span>
    <span class="token comment" spellcheck="true">#     sess.run(optimizer)</span>
    <span class="token comment" spellcheck="true">#     print('第%d次训练后模型参数为：权重为%f，偏置为%f 损失为%f' % (i+1,weights.eval(), bias.eval(), error.eval()))</span>
    <span class="token comment" spellcheck="true"># #print('训练后模型参数为：权重为%f，偏置为%f 损失为%f' % (weights.eval(),bias.eval(),error.eval()))</span>
    <span class="token comment" spellcheck="true">#     #运行合并变量操作</span>
    <span class="token comment" spellcheck="true">#     summary=sess.run(merged)</span>
    <span class="token comment" spellcheck="true">#     #将每次迭代后的变量写入事件文件</span>
    <span class="token comment" spellcheck="true">#     file_writer.add_summary(summary,i)</span>
    <span class="token comment" spellcheck="true">#     #保存模型</span>
    <span class="token comment" spellcheck="true">#     saver.save(sess,'./tmp/my_linear.ckpt')</span>
    <span class="token comment" spellcheck="true">#加载模型,先判断文件是否存在</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'./tmp/checkpoint'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        saver<span class="token punctuation">.</span>restore<span class="token punctuation">(</span>sess<span class="token punctuation">,</span><span class="token string">'./tmp/my_linear.ckpt'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练后模型参数为：权重为%f，偏置为%f 损失为%f'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>weights<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bias<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>d、命令行参数使用：</p>
<p><strong>第一步：</strong>tf.app.flags   它支持应用从命令行接受参数，可以用来指定集群配置等，在tf.app.flags下面有各种定义参数的类型，如 </p>
<p>整形：tf.app.flags.DEFINE_integer(‘max_step’,0,’训练模型的步数’)   第一个参数是参数名字（flag_name），第二个参数是（default_value），赋给第一个参数用的，第三个参数是对变量的说明（docstring），比说是训练模型的步数</p>
<p>字符串：tf.app.flags.DEFINE_string(‘model_dir’,’ ‘,’模型保存的路径+模型名字’)  </p>
<p><strong>第二步：</strong>在flags中有一个FLASS标志，它在程序中可以调用到我们前面具体定义的flag_name</p>
<p>FLAGS=tf.app.flags.FLAGS  通过FLAGS.max_step调用命令行中传过来的参数</p>
<p>如何在命令行中传参：做好一二步之后，在cmd中切到py路径，输入python 深度学习演示代码1-黑马程序员.py –max_step=200 –model_dir=’hello’  即可完成传参</p>
<p><strong>第三步：</strong>通过tf.app.run() 启动main(argv)函数   argv是py程序的路径</p>
<h4 id="3、以上内容总结："><a href="#3、以上内容总结：" class="headerlink" title="3、以上内容总结："></a><strong>3、以上内容总结：</strong></h4><p>1、深度学习介绍 —&gt;深度学习与机器学习的区别</p>
<p>​                                                                                 2-1-1：图—&gt;定义数据（Tensor对象）和操作（Operation）对象</p>
<p>​                                                     2-1：TensorFlow整体结构 —&gt;</p>
<p>​                                                                                 2-1-2：会话—&gt;执行图</p>
<p>​                                                                                 2-2-1：默认图查看  tf.get_default_graph()   查看图属性 .graph</p>
<p>2、TensorFlow框架介绍 —&gt;    2-2：图  —&gt;</p>
<p>​                                                                                 2-2-2：自定义图    tf.Graph() 创建图   new_g.as_default() </p>
<p>​       </p>
<p>​                                                     2-3：会话 —&gt;sess.run(fetches,feed_dict)    placeholder</p>
<p>​                                                                                 </p>
<p>​                                                                                 2-4-1：属性  shape、dtype</p>
<p>​                                                     2-4：张量 —&gt;    2-4-2：生成   </p>
<p>​                                                                                    2-4-3-1：修改张量类型(tf.cast(tensor,dtype))</p>
<p>​                                                                                 2-4-3：修改属性 —&gt; </p>
<p>​                                                                                    2-4-3-2： 修改张量形状 静(tensor.set_shape()) 动(tf.reshape())</p>
<p>​                                                                              </p>
<p>​                                                                                 2-4-4：运算</p>
<p>​                                                     2-5：操作 —&gt;   操作函数 操作对象</p>
<p>​                                                                               2-6-1：特点：存储模型参数</p>
<p>​                                                     2-6：变量  —&gt; 2-6-2：显式地初始化变量</p>
<p>​                                                                               2-6-3：修改变量的命名空间</p>
<p>​                                                     2-7：Tensorboard可视化—&gt; 创建事件文件 、tensorboard –logdir</p>
<h4 id="4、数据读取、神经网络："><a href="#4、数据读取、神经网络：" class="headerlink" title="4、数据读取、神经网络："></a><strong>4、数据读取、神经网络：</strong></h4><p>1）文件读取流程：</p>
<p>a、三种获取数据到TensorFlow程序的方法：</p>
<p><img src="D:\Machine learning\深度学习image\数据.png" alt=""></p>
<p>b、QueueRunner：多线程+队列</p>
<p><img src="D:\Machine learning\深度学习image\df144ce194ddcd3e7f98909846ad2553.gif" alt=""></p>
<p>第一阶段：构造文件名队列</p>
<p><strong>file_queue=tf.train.string_input_producer(string_tensor,shuffle=True)  返回的结果是文件队列</strong></p>
<p>●string_tensor：含有文件名+路径的列表</p>
<p>●num_epochs：过几遍数据，默认无限过数据</p>
<p>●shuffle：是否打乱读取文件名的顺序，默认为True</p>
<p>第二阶段：读取与解码</p>
<p>a）读取、阅读器默认每次只读取一个样本，如文本文件默认一次读取一行，图片文件默认一次读取图片，二进制文件一次读取指定字节数</p>
<p>●tf.TextLineReader：阅读<strong>文本文件</strong>逗号分隔值（CSV）格式，默认按行读取，返回的结果是读取器实例</p>
<p>●tf.WholeFileReader：用于读取<strong>图片格式</strong>， 返回的结果是读取器实例</p>
<p>●tf.FixedLengthRecordReader(record_bytes)：要读取每个记录是固定数量字节的<strong>二进制文件</strong>，返回的结果是读取器实例，record_bytes是整型，指定每次读取（一个样本）的字节数</p>
<p>●tf.TFRecordReader：读取<strong>TFRecords文件</strong>，返回的结果是读取器实例</p>
<p>这些读取器都有方法  .read(file_queue) ，并且返回一个Tensors元组，即：</p>
<p>key,value=读取器.read(file_queue)   </p>
<p>key：样本所在文件的名字</p>
<p>value：一个样本读取的内容</p>
<p>由于默认只会读取一个样本，所以如果想要进行批处理，需要使用tf.train.batch或tf.train.shuffle_batch进行批处理，便于之后指定每批次多个样本的训练</p>
<p>b）内容解码：不同类型的文件，解码操作不同，默认所有的内容都解码成tf.uint8类型，如果之后需要转换成指定类型，则可使用tf.cast()进行相应转换</p>
<p>●tf.decode_csv：解码文本文件内容</p>
<p>●tf.image.decode_jpeg(contents)：将JPEG编码的图像解码为uint8张量，返回的结果是uint8张量，3-D形状[height,width,channels]</p>
<p>●tf.image.decode_png(contents)：将PNG编码的图像解码为uint8张量，返回的结果是uint8张量，3-D形状[height,width,channels]</p>
<p>●tf.decode_raw：解码二进制文件内容，与tf.FixedLengthRecordReader搭配使用，二进制读取为uint8类型</p>
<p>第三阶段：将样本放到批处理队列中</p>
<p>tf.train.batch(tensors,batch_size,num_threads=1,capacity=32,name=None)  读取指定大小（个数）的张量，返回的是tensors</p>
<p>●tensors：可以是包含张量的列表，批处理的内容放到列表当中</p>
<p>●batch_size：从队列中读取的批处理大小，一次处理几个样本</p>
<p>●num_threads：进入队列的线程数</p>
<p>●capacity：整数，队列中元素的最大数量</p>
<p>tf.train.shuffle_batch</p>
<p>手动开启线程，才能运行以上三个阶段的操作：</p>
<p>以上用到的队列都是tf.train.QueueRunner对象。每个QueueRunner都负责一个阶段，tf.train.start_queue_runners(在会话中运行)函数会要求图中的每个QueueRunner启动它的运行队列操作的线程</p>
<p><strong>tf.train.start_queue_runners(sess=None,coord=None)  收集图中所有的队列线程，默认同时启动线程，返回的结果是所有线程</strong></p>
<p>●sess：所在的会话</p>
<p>●coord：线程协调器</p>
<p><strong>tf.train.Coordinator()  线程协调员，对线程进行管理和协调 ，返回的结果是线程协调员实例</strong></p>
<p>●request_stop()：请求停止</p>
<p>●should_stop()：询问是否结束</p>
<p>●join(threads=None,stop_grace_period_secs=120)：回收线程</p>
<p>2）图片数据：</p>
<p>a、图片三要素：图片长度、宽度、通道数</p>
<p>灰度图 –&gt; 单通道   彩色图  –&gt; 三通道</p>
<p>b、张量形状：  Tensor（指令名称，shape，dtype）</p>
<p>一张图片  shape=(h,w,c)</p>
<p>多张图片   shape=(batch,h,w,c)   batch表示一个批次的张量数量</p>
<p>c、图片特征值处理：</p>
<p>一个样本特征值多，数据量大，并且样本和样本的形状不统一，没办法进行批量操作和运算，所以要对所有样本缩放到统一大小</p>
<p><strong>tf.image.resize_images(images,size)  缩小放大图片  返回的结果是4-D格式或者3-D格式</strong></p>
<p>●images：4-D形状[batch，height，width，channels]或3-D[height,width,channels]</p>
<p>●size：new_height,new_width  图像的新尺寸</p>
<p>d、数据格式： 存储：uint8（节约空间） 矩阵计算：float32（提高精度）</p>
<p>e、狗图片处理案列</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#1、构造文件名队列</span>
<span class="token comment" spellcheck="true">#构造路径+文件名的列表</span>
filename<span class="token operator">=</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'./深度学习image/狗'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#print(filename)</span>
<span class="token comment" spellcheck="true">#拼接路径+文件名</span>
file_list<span class="token operator">=</span><span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'.\\深度学习image\\狗'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span> <span class="token keyword">for</span> file <span class="token keyword">in</span> filename<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">#print(file_list)</span>
file_queue<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>string_input_producer<span class="token punctuation">(</span>file_list<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#2、读取与解码</span>
<span class="token comment" spellcheck="true">#读取阶段</span>
reader<span class="token operator">=</span>tf<span class="token punctuation">.</span>WholeFileReader<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#key是文件名，value是一张图片的原始编码形式</span>
key<span class="token punctuation">,</span>value<span class="token operator">=</span>reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span>file_queue<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#解码阶段</span>
image<span class="token operator">=</span>tf<span class="token punctuation">.</span>image<span class="token punctuation">.</span>decode_jpeg<span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#图像的形状、类型修改</span>
image_resize<span class="token operator">=</span>tf<span class="token punctuation">.</span>image<span class="token punctuation">.</span>resize_images<span class="token punctuation">(</span>image<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#静态形状修改</span>
image_resize<span class="token punctuation">.</span>set_shape<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#3、批处理</span>
image_batch<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token punctuation">[</span>image_resize<span class="token punctuation">]</span><span class="token punctuation">,</span>batch_size<span class="token operator">=</span><span class="token number">48</span><span class="token punctuation">,</span>num_threads<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>capacity<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#4、开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#开启线程</span>
    <span class="token comment" spellcheck="true">#创建线程协调员</span>
    coord<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Coordinator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    threads<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>start_queue_runners<span class="token punctuation">(</span>sess<span class="token operator">=</span>sess<span class="token punctuation">,</span>coord<span class="token operator">=</span>coord<span class="token punctuation">)</span>
    key_new<span class="token punctuation">,</span>value_new<span class="token punctuation">,</span>image_batch_new<span class="token punctuation">,</span>image_resize_new<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>image_batch<span class="token punctuation">,</span>image_resize<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'key_new:\n'</span><span class="token punctuation">,</span>key_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'value_new:\n'</span><span class="token punctuation">,</span>value_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_batch_new:\n'</span><span class="token punctuation">,</span> image_batch_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_resize_new:\n'</span><span class="token punctuation">,</span>image_resize_new<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">#回收线程</span>
    coord<span class="token punctuation">.</span>request_stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coord<span class="token punctuation">.</span>join<span class="token punctuation">(</span>threads<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>3）二进制数据：</p>
<p>a、CIFAR-10数据集： 每3073个字节是一个样本，样本由1个标签(目标)值（0-9的数字组成，共10类）+3072个特征值（像素）组成（前1024个字节为红色通道，中1024个通道为绿色通道，后1024个通道为蓝色通道）</p>
<p>b、Tensorflow 图像格式是[通道数，高，宽]，转为[高，宽，通道数]需要用到转置：</p>
<p><img src="D:\Machine learning\深度学习image\转置.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\转置1.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#初始化操作</span>
h<span class="token operator">=</span><span class="token number">32</span>
w<span class="token operator">=</span><span class="token number">32</span>
c<span class="token operator">=</span><span class="token number">3</span>
<span class="token comment" spellcheck="true">#字节数</span>
<span class="token comment" spellcheck="true">#特征值字节</span>
image_bytes<span class="token operator">=</span>h<span class="token operator">*</span>w<span class="token operator">*</span>c
<span class="token comment" spellcheck="true">#标签值字节</span>
label_bytes<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment" spellcheck="true">#一个样本的字节</span>
all_bytes<span class="token operator">=</span>label_bytes<span class="token operator">+</span>image_bytes

<span class="token comment" spellcheck="true">#1、构造文件名队列</span>
file_name<span class="token operator">=</span>os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'./tmp'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#构造文件名+路径列表</span>
file_list<span class="token operator">=</span><span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'./tmp'</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span> <span class="token keyword">for</span> file <span class="token keyword">in</span> file_name <span class="token keyword">if</span> file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'bin'</span><span class="token punctuation">]</span>
file_queue<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>string_input_producer<span class="token punctuation">(</span>file_list<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#2、读取与解码</span>
<span class="token comment" spellcheck="true">#读取阶段</span>
reader<span class="token operator">=</span>tf<span class="token punctuation">.</span>FixedLengthRecordReader<span class="token punctuation">(</span>all_bytes<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#key文件名，value一个样本</span>
key<span class="token punctuation">,</span>value<span class="token operator">=</span>reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span>file_queue<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#解码阶段</span>
decoded<span class="token operator">=</span>tf<span class="token punctuation">.</span>decode_raw<span class="token punctuation">(</span>value<span class="token punctuation">,</span>tf<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#切片,将目标值label与特征值image分开,第二个参数是索引,从几开始切,第三个参数是切片的长度</span>
label<span class="token operator">=</span>tf<span class="token punctuation">.</span>slice<span class="token punctuation">(</span>decoded<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>label_bytes<span class="token punctuation">)</span>
image<span class="token operator">=</span>tf<span class="token punctuation">.</span>slice<span class="token punctuation">(</span>decoded<span class="token punctuation">,</span><span class="token punctuation">[</span>label_bytes<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>image_bytes<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#调整图片形状,将一维转为三维,注意tensorflow中图片形状是（通道，高，宽）</span>
image_reshape<span class="token operator">=</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>image<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span>c<span class="token punctuation">,</span>h<span class="token punctuation">,</span>w<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#转置，将图片顺序转为h,w,c</span>
image_transpose<span class="token operator">=</span>tf<span class="token punctuation">.</span>transpose<span class="token punctuation">(</span>image_reshape<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#调整图像类型 uint8 -->float32</span>
image_cast<span class="token operator">=</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>image_transpose<span class="token punctuation">,</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#3、批处理</span>
label_batch<span class="token punctuation">,</span>image_batch<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token punctuation">[</span>label<span class="token punctuation">,</span>image_cast<span class="token punctuation">]</span><span class="token punctuation">,</span>batch_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>num_threads<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>capacity<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#开启线程</span>
    coord<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Coordinator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    threads<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>start_queue_runners<span class="token punctuation">(</span>sess<span class="token operator">=</span>sess<span class="token punctuation">,</span>coord<span class="token operator">=</span>coord<span class="token punctuation">)</span>
    key_new<span class="token punctuation">,</span>value_new<span class="token punctuation">,</span>decoded_new<span class="token punctuation">,</span>label_new<span class="token punctuation">,</span>image_new<span class="token punctuation">,</span>image_reshape_new<span class="token punctuation">,</span>image_transpose_new<span class="token punctuation">,</span>label_batch_new<span class="token punctuation">,</span>image_batch_new<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>decoded<span class="token punctuation">,</span>label<span class="token punctuation">,</span>image<span class="token punctuation">,</span>image_reshape<span class="token punctuation">,</span>image_transpose<span class="token punctuation">,</span>label_batch<span class="token punctuation">,</span>image_batch<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'key_new:\n'</span><span class="token punctuation">,</span>key_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'value_new:\n'</span><span class="token punctuation">,</span>value_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'decoded_new:\n'</span><span class="token punctuation">,</span>decoded_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'label_new:\n'</span><span class="token punctuation">,</span>label_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_new:\n'</span><span class="token punctuation">,</span>image_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_reshape_new:\n'</span><span class="token punctuation">,</span>image_reshape_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_transpose_new:\n'</span><span class="token punctuation">,</span>image_transpose_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'label_batch_new:\n'</span><span class="token punctuation">,</span>label_batch_new<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_batch_new:\n'</span><span class="token punctuation">,</span>image_batch_new<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#回收线程</span>
    coord<span class="token punctuation">.</span>request_stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coord<span class="token punctuation">.</span>join<span class="token punctuation">(</span>threads<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>4）TFRecords：其实是一种二进制文件，能更好的利用内存，方便复制和移动，并且不需要单独的标签文件</p>
<p>a、步骤：获取数据 –&gt;将数据填入到Example协议内存块 –&gt;将协议内存块序列化为字符串，并且通过tf.python_io.TFRecordWriter写入到TFRecords文件（后缀是.tfrecords）</p>
<p>b、Example结构解析：一个Example代表一个样本</p>
<p><img src="D:\Machine learning\深度学习image\example.png" alt=""></p>
<p>c、Example  API：</p>
<p>●tf.train.Example(features=None) 写入tfrecords文件，返回的结果是example格式协议块</p>
<p>features：tf.train.Features类型的特征实例</p>
<p>●tf.train.Features(feature=None)  构建每个样本的信息键值对，返回的结果是Features类型</p>
<p>feature：字典数据，key为要保存的名字  value为tf.train.Feature实例</p>
<p>●tf.train.Feature(options) </p>
<p>options：例如</p>
<p>bytes_list=tf.train.BytesList(value=[Bytes])   [image（特征值）可以用这个]</p>
<p>int64_list=tf.train.Int64List(value=[Value])    [label（目标值）可以用这个]</p>
<p>支持存入的类型如下：</p>
<p>tf.train.Int64List(value=[Value])</p>
<p>tf.train.BytesList(value=[Bytes])</p>
<p>tf.train.FloatList(value=[value])</p>
<p>eg：</p>
<pre class="line-numbers language-python"><code class="language-python">example <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Example<span class="token punctuation">(</span>features<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Features<span class="token punctuation">(</span>feature<span class="token operator">=</span><span class="token punctuation">{</span>

    <span class="token string">'image'</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>bytes_list<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>BytesList<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">[</span>image<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token string">'label'</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>int64_list<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Int64List<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token punctuation">[</span>label<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>example仍是一个对象，若想写到TFRecords文件，需要转为bytes类型：</p>
<p>example.SerializeToString()</p>
<p>d、读取TFRecords文件API：读取这种文件与其他文件一样，只不过需要解析Example，从TFRecords文件中读取数据，可以使用tf.TFRecordReader的tf.parse_single_example解析器，这个操作可以将Example解析成张量</p>
<p>步骤：构造文件名队列—&gt;读取 —&gt;解析example—&gt;解码—&gt;构造批处理队列</p>
<p><strong>tf.parse_single_example(serialized,features=None,name=None) 解析一个单一的Example原型，返回的结果是一个键值对组成的字典，键为读取的名字</strong></p>
<p>●serialized：标量字符串Tensor，一个序列化的Example，即key，value中的value</p>
<p>●features：dict字典数据，键为读取的名字，值为FixedLenFeature</p>
<p><strong>tf.FixedLenFeature(shape,dtype)</strong></p>
<p>●shape：输入数据的形状，一般不指定，为空列表</p>
<p>●dtype：输入数据的类型，与存储进文件的类型要一致，类型只能是float32、int64、string</p>
<p>解析example   eg：</p>
<pre class="line-numbers language-python"><code class="language-python">feature<span class="token operator">=</span>tf<span class="token punctuation">.</span>parse_single_example<span class="token punctuation">(</span>value<span class="token punctuation">,</span>features<span class="token operator">=</span><span class="token punctuation">{</span>

<span class="token string">'image'</span><span class="token punctuation">:</span>tf<span class="token punctuation">.</span>FixedLenFeature<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token string">'label'</span><span class="token punctuation">:</span>tf<span class="token punctuation">.</span>FixedLenFeature<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
image<span class="token operator">=</span>feature<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span>
label<span class="token operator">=</span>feature<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>label是整型，不需要解码，所以对image进行解码tf.decode_raw()</p>
<p>e、案例：CIFAR10数据存入TFRecords文件</p>
<p>分析：</p>
<p>构造存储实例，tf.python_io.TFRecordWriter(path)  写入tfrecords文件</p>
<p>●path：TFRecords文件的路径</p>
<p>●return：写文件</p>
<p>   method方法：</p>
<p>​             write(record)：向文件中写入一个example</p>
<p>​             close()：关闭文件写入器</p>
<p>循环将数据填入到Example协议内存块，在循环将Example样本写入到TFRecords文件里</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

<span class="token comment" spellcheck="true">#初始化操作</span>
h<span class="token operator">=</span><span class="token number">32</span>
w<span class="token operator">=</span><span class="token number">32</span>
c<span class="token operator">=</span><span class="token number">3</span>
<span class="token comment" spellcheck="true">#字节数</span>
<span class="token comment" spellcheck="true">#特征值字节</span>
image_bytes<span class="token operator">=</span>h<span class="token operator">*</span>w<span class="token operator">*</span>c
<span class="token comment" spellcheck="true">#标签值字节</span>
label_bytes<span class="token operator">=</span><span class="token number">1</span>
<span class="token comment" spellcheck="true">#一个样本的字节</span>
all_bytes<span class="token operator">=</span>label_bytes<span class="token operator">+</span>image_bytes

<span class="token comment" spellcheck="true">#1、构造文件名队列</span>
file_queue<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>string_input_producer<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'xxx.tfrecords'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#2、读取与解码</span>
<span class="token comment" spellcheck="true">#读取</span>
reader<span class="token operator">=</span>tf<span class="token punctuation">.</span>TFRecordReader<span class="token punctuation">(</span><span class="token punctuation">)</span>
key<span class="token punctuation">,</span>value<span class="token operator">=</span>reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span>file_queue<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#解析example</span>
feature<span class="token operator">=</span>tf<span class="token punctuation">.</span>parse_single_example<span class="token punctuation">(</span>value<span class="token punctuation">,</span>features<span class="token operator">=</span><span class="token punctuation">{</span>

<span class="token string">'image'</span><span class="token punctuation">:</span>tf<span class="token punctuation">.</span>FixedLenFeature<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token string">'label'</span><span class="token punctuation">:</span>tf<span class="token punctuation">.</span>FixedLenFeature<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>int64<span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
image<span class="token operator">=</span>feature<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span>
label<span class="token operator">=</span>feature<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">#解码</span>
image_decode<span class="token operator">=</span>tf<span class="token punctuation">.</span>decode_raw<span class="token punctuation">(</span>image<span class="token punctuation">,</span>tf<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#图像形状调整</span>
image_reshape<span class="token operator">=</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>image_decode<span class="token punctuation">,</span><span class="token punctuation">[</span>h<span class="token punctuation">,</span>w<span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment" spellcheck="true">#3、构造批处理队列</span>
image_batch<span class="token punctuation">,</span>label_batch<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token punctuation">[</span>image_reshape<span class="token punctuation">,</span>label<span class="token punctuation">]</span><span class="token punctuation">,</span>batch_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>num_threads<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>capacity<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#开启线程</span>
    coord<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Coordinator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    threads<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>start_queue_runners<span class="token punctuation">(</span>sess<span class="token operator">=</span>sess<span class="token punctuation">,</span>coord<span class="token operator">=</span>coord<span class="token punctuation">)</span>
    image_value<span class="token punctuation">,</span>label_value<span class="token punctuation">,</span>image_batch_value<span class="token punctuation">,</span>label_batch_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>image<span class="token punctuation">,</span>label<span class="token punctuation">,</span>image_batch<span class="token punctuation">,</span>label_batch<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_value:\n'</span><span class="token punctuation">,</span> image_value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'label_value:\n'</span><span class="token punctuation">,</span>label_value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'image_batch_value:\n'</span><span class="token punctuation">,</span>image_batch_value<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'label_batch_value:\n'</span><span class="token punctuation">,</span>label_batch_value<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#回收线程</span>
    coord<span class="token punctuation">.</span>request_stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coord<span class="token punctuation">.</span>join<span class="token punctuation">(</span>threads<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>5）神经网络基础：</p>
<p>a、人工神经网络（ANN），简称神经网络（NN），是一种模仿生物神经网络结构和功能的计算模型，经典的神经网络结构包含三个层次的神经网络，分别为输入层、隐藏层和输出层</p>
<p><img src="D:\Machine learning\深度学习image\神经网络.png" alt=""></p>
<p>b、playground的使用：playground.tensorflow.org</p>
<p>c、感知机（PLA）：</p>
<p><img src="D:\Machine learning\深度学习image\感知机.png" alt=""></p>
<p>sign函数：</p>
<p><img src="D:\Machine learning\深度学习image\sign函数.png" alt=""></p>
<p>感知机可以解决的简单的问题：</p>
<p>或问题：x1、x2两个输入，只有两个输入都是0才能输出0</p>
<p>与问题：x1、x2两个输入，只有两个输入都是1才能输出1</p>
<p>但是不能解决异或问题：</p>
<p>异或问题：x1、x2两个输入，两个输入相同为0，不同为1</p>
<p>所以，想解决异或问题，需要给网络增加一些结构</p>
<p>6）神经网络原理：</p>
<p>a、神经网络的主要用途在于分类</p>
<p>b、softmax回归：将神经网络输出转换成概率结果</p>
<p>线性回归的输出+softmax映射 就可以解决多分类问题</p>
<p>c、思路：构造损失函数、优化损失函数</p>
<p>c-1：构造损失函数：交叉熵损失，yi‘是真实值，yi是输出的结果</p>
<p><img src="D:\Machine learning\深度学习image\交叉熵损失.png" alt=""></p>
<p>该图真实值为1的预测概率并不是最大值，所以该图预测错误，它的损失根据上面公式可得：</p>
<p>-0<em>log(0.1)+-0</em>log(0.05)+…+-1<em>log(0.1)+…=-1</em>log(0.1)</p>
<p>损失大小：求总损失，再求平均</p>
<p>d、softmax、交叉熵损失API：</p>
<p><strong>tf.nn.softmax_cross_entropy_with_logits(labels=None,logits=None,name=None) 计算logits和labels之间的交叉损失熵，返回的结果是损失值列表</strong></p>
<p>●labels：标签值（真实值）</p>
<p>●logits：样本加权之后的值</p>
<p><strong>tf.reduce_mean(input_tensor) 计算张量的尺寸的元素平均值</strong></p>
<p><img src="D:\Machine learning\深度学习image\softmax.png" alt=""></p>
<p>e、案例：Mnist手写数字识别</p>
<p>e-1：Mnist数据集   特征值：28*28=784个元素构成   目标值：分类的结果one-hot编码  0-9</p>
<p>数据集被分成两部分：60000 行的训练数据集（mnist.train）和<a href="https://www.baidu.com/s?wd=10000&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">10000</a>行的测试数据集（mnist.test）。 </p>
<p>e-2：API：</p>
<p><strong>from tensorflow.examples.tutorials.mnist import input_data</strong></p>
<p>   <strong>mnist=input_data.read_data_sets(path,one_hot=True)</strong></p>
<p>​     ●mnist.train.next_batch(100) (提供批量获取功能)</p>
<p>​     ●mnist.train.images、labels (查看训练集的特征值和目标值)</p>
<p>​     ●mnist.test.images、labels(查看测试集的特征值和目标值)</p>
<p>e-3：全连接层计算：y=w1x1+w2x2+…+b</p>
<p>x[None,784] *w +bias[10]=y_predict[None,10]  —&gt;   w[784,10]</p>
<p>error=tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=y_true,logits=y_predict,name=None) )</p>
<p>e-4：准确率计算：</p>
<p>步骤：</p>
<p>​          1、比较输出的结果最大值所在位置和真实值的最大值所在位置</p>
<p>​      y_true(None,10)    求列中最大值位置 tf.argmax(y_true,1)    tf.argmax(y_predict,1)</p>
<p>​         equal_list(布尔值)=tf.equal(tf.argmax(y_true,1),tf.argmax(y_predict,1)) </p>
<p>​         accuracy=tf.reduce_mean(tf.cast(equal_list,tf.float32))(布尔值转小数)      </p>
<p>​    2、求平均</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>tutorials<span class="token punctuation">.</span>mnist <span class="token keyword">import</span> input_data


<span class="token comment" spellcheck="true">#1、准备数据</span>
mnist<span class="token operator">=</span>input_data<span class="token punctuation">.</span>read_data_sets<span class="token punctuation">(</span><span class="token string">'./mnist_data'</span><span class="token punctuation">,</span>one_hot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>None<span class="token punctuation">,</span><span class="token number">784</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_true<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>None<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#2、构建模型</span>
w<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">784</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_predict<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token operator">+</span>b

<span class="token comment" spellcheck="true">#3、构造损失函数</span>
error<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>softmax_cross_entropy_with_logits<span class="token punctuation">(</span>labels<span class="token operator">=</span>y_true<span class="token punctuation">,</span>logits<span class="token operator">=</span>y_predict<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#4、优化损失  梯度下降</span>
optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>GradientDescentOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>error<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#5、准确率计算</span>
equal_list<span class="token operator">=</span>tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
accuracy<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>equal_list<span class="token punctuation">,</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#初始化变量</span>
init<span class="token operator">=</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
    image<span class="token punctuation">,</span>label<span class="token operator">=</span>mnist<span class="token punctuation">.</span>train<span class="token punctuation">.</span>next_batch<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'训练之前，损失为%f'</span> <span class="token operator">%</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>error<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>image<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>label<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#开始训练</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">#optimizer不用接，可以用_代替</span>
        _<span class="token punctuation">,</span>loss<span class="token punctuation">,</span>accuracy_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>optimizer<span class="token punctuation">,</span>error<span class="token punctuation">,</span>accuracy<span class="token punctuation">]</span><span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>image<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>label<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第%d次的训练，损失为%f,准确率为%f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>loss<span class="token punctuation">,</span>accuracy_value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="5、以上内容总结："><a href="#5、以上内容总结：" class="headerlink" title="5、以上内容总结："></a><strong>5、以上内容总结</strong>：</h4><p>​                                                                              1-1-1：文件通用读取流程–&gt;构造文件名队列、读取与解码、批处理</p>
<p>​                                     1-1：QueueRunner–&gt;  1-1-2：图片读取</p>
<p>​                                                                               1-1-3：二进制文件读取</p>
<p>​                                                                               1-1-4：TFRecords读写</p>
<p>1、数据IO操作  —&gt;          </p>
<p>​                                     1-2：feeding  —&gt; 配合tf.placeholder()</p>
<p>​                                       2-1：感知机 –&gt;对比逻辑回归：激活函数不一样</p>
<p>​                                                                          </p>
<p>2、神经网络基础  —&gt;  </p>
<p>​                                                                            2-2-1：softmax函数</p>
<p>​                                       2-2：全连接分类 –&gt;  2-2-2：交叉熵损失</p>
<p>​                                                                           2-2-3：梯度下降</p>
<p>​                                                                           2-2-4：准确率</p>
<p>​                                  </p>
<h4 id="6、卷积神经网络："><a href="#6、卷积神经网络：" class="headerlink" title="6、卷积神经网络："></a><strong>6、卷积神经网络：</strong></h4><p>1）卷积神经网络简介：</p>
<p>卷积神经网络与传统多层神经对比：</p>
<p>传统神经网络：输入层、隐藏层、输出层</p>
<p>卷积神经网络：输入层、隐藏层（加入卷积层、激活层、池化层（下采样层）、全连接层）、输出层</p>
<p>2）卷积神经网络原理：</p>
<p>a、卷积神经网络结构：卷积层、激活层、池化层、全连接层</p>
<p><img src="D:\Machine learning\深度学习image\cnn结构.png" alt=""></p>
<p>b、卷积层：通过在原始图像上平移来提取特征</p>
<p>卷积层由若干卷积核（filter/过滤器/卷积单元/模型参数）组成，四大要素：个数、大小、步长、零填充的大小，目的是特征提取，第一层卷积层可能只提取一些低级的特征（如边缘、线条等）更多层的网络能从低级特征中迭代提取更复杂的特征</p>
<p>b-1：大小：</p>
<p><img src="D:\Machine learning\深度学习image\卷积核.png" alt=""></p>
<p>输入的图像是5 <em> 5，filter是3 </em> 3  步长为1，输出的图像是3*3</p>
<p>b-2：步长：平移的长度</p>
<p>输入的图像是5 <em> 5，filter是3 </em> 3  步长为2，输出的图像是2*2</p>
<p>b-3：卷积核的个数：如果多个卷积核一起运行，会得到多张结果</p>
<p>注：不同的卷积核带的权重和偏置都不一样，即随机初始化的参数</p>
<p>b-4：零填充的大小：零填充就是在图片像素外围填充x圈值为0的像素，避免了步长不合适超出边缘的情况</p>
<p><img src="D:\Machine learning\深度学习image\零填充.png" alt=""></p>
<p>b-5：输出大小计算公式：</p>
<p><img src="D:\Machine learning\深度学习image\零填充1.png" alt=""></p>
<p>b-6：多通道观察：</p>
<p>输入图片是5 <em> 5 </em> 3  两个 fileter 3 <em> 3 </em> 3   步长为2</p>
<p>H1=7 D1=3 K=2 F=3 S=2 P=1  –&gt; H2=3  D2=2    输入图片是3 <em>3 </em> 2</p>
<p><strong>结论：输入图像的通道数等于filter的数量</strong></p>
<p>b-7：卷积神经API：</p>
<p> <strong>tf.nn.conv2d(input,filter,strides=,padding=,name=None)  计算给定4-D input和filter张量的2维卷积</strong></p>
<p>●input：给定的输入张量，[batch，height，width，channel]，输入图像类型为float32，64</p>
<p>●filter：指定过滤器的权重数量，[filter_height,filter_width,in_channels,out_channels]</p>
<p>●strides：步长  strides=[1,stride,stride,1]，步长为1 –&gt;  strides=[1,1,1,1]</p>
<p>●padding：零填充  “SAME”，“VALID” </p>
<p><strong>TensorFlow的零填充方式有两种方式，SAME、VALID</strong></p>
<p>●SAME：越过边缘取样，取样的面积和输入图像的像素宽度一致，常用</p>
<p>●VALID：不越过边缘取样，取样的面积小于输入人的图像的像素宽度，不填充，舍弃一些特征值</p>
<p><strong>注：在TensorFlow中，卷积API设置“SAME”之后，如果步长为1，输出高宽与输入大小一样</strong></p>
<p>c、激活层：增加非线性分割能力</p>
<p>c-1：sigmoid激活函数 计算量大，反向传播时，容易出现梯度消失</p>
<p>而Relu激活函数：</p>
<p><img src="D:\Machine learning\深度学习image\Relu.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\relu1.png" alt=""></p>
<p>Relu优点：计算速度快，解决了梯度消失问题，图像没有负的像素值，可以解决非线性分类问题。</p>
<p>c-2：Relu激活函数API：</p>
<p><strong>tf.nn.relu(features,name=None) </strong> </p>
<p>●features：输入卷积层后加入偏置的结果</p>
<p>d、池化层：主要作用也是特征提取，减少学习的参数，降低网络的复杂度，防止了过拟合(最大池化和平均池化)</p>
<p>d-1：最大池化：取池化窗口的最大值（常用）     平均池化：取池化窗口的平均值</p>
<p>最大池化：利用图像像素点之间的联系，用最大像素代替区域</p>
<p><img src="D:\Machine learning\深度学习image\最大池化.png" alt=""></p>
<p>d-2：池化层API：</p>
<p><strong>tf.nn.max_pool(value,ksize=,strides=,padding=,name=None)  输入上执行最大池数</strong></p>
<p>●value：4-D形状 [batch,height,width,channels]</p>
<p>●channel：并不是原始图片的通道数，而是有多少filter在观察</p>
<p>●ksize：池化窗口大小，[1,ksize,ksize,1]  窗口为2*2 –&gt; [1,2,2,1] </p>
<p>●strides：步长大小，[1,strides,strides,1]   步长为2 –&gt; [1,2,2,1] </p>
<p>●padding：“SAME”，“VALID”，使用的填充算法的类型，默认值为“SAME”</p>
<p>e、全连接层：进行最终的分类，起分类器的作用</p>
<p>f、卷积神经网络实现：</p>
<p><img src="D:\Machine learning\深度学习image\卷积cnn.png" alt=""></p>
<p>练习题：</p>
<p><img src="D:\Machine learning\深度学习image\卷积计算1.png" alt=""></p>
<p>答案：C</p>
<p>3）案例：CNN-Mnist手写数字识别</p>
<p>a、网络结构：</p>
<p><img src="D:\Machine learning\深度学习image\网络结构.png" alt=""></p>
<p>b、设计具体参数：</p>
<p><img src="D:\Machine learning\深度学习image\第一层.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\第二层.png" alt=""></p>
<p><img src="D:\Machine learning\深度学习image\第三层.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>examples<span class="token punctuation">.</span>tutorials<span class="token punctuation">.</span>mnist <span class="token keyword">import</span> input_data
<span class="token keyword">import</span> os

os<span class="token punctuation">.</span>environ<span class="token punctuation">[</span><span class="token string">'TF_CPP_MIN_LOG_LEVEL'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'2'</span>

tf<span class="token punctuation">.</span>app<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>DEFINE_integer<span class="token punctuation">(</span><span class="token string">'is_train'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'指定是否是训练模型，还是拿数据去预测'</span><span class="token punctuation">)</span>
FLAGS<span class="token operator">=</span>tf<span class="token punctuation">.</span>app<span class="token punctuation">.</span>flags<span class="token punctuation">.</span>FLAGS

<span class="token comment" spellcheck="true">#1、准备数据</span>
mnist<span class="token operator">=</span>input_data<span class="token punctuation">.</span>read_data_sets<span class="token punctuation">(</span><span class="token string">'./mnist_data'</span><span class="token punctuation">,</span>one_hot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>None<span class="token punctuation">,</span><span class="token number">784</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_true<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>None<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#2、构建卷积神经网络</span>
<span class="token comment" spellcheck="true">#第一个卷积大层</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'conv1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#将x[None,784]形状进行修改</span>
    input_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#定义filter和偏置</span>
    conv1_w<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conv1_b<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#卷积层</span>
    conv1_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>input_x<span class="token punctuation">,</span>filter<span class="token operator">=</span>conv1_w<span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span><span class="token operator">+</span>conv1_b
    <span class="token comment" spellcheck="true">#激活层</span>
    relu1_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>conv1_x<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#池化层</span>
    pool1_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>value<span class="token operator">=</span>relu1_x<span class="token punctuation">,</span>ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#第二个卷积大层</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'conv2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#定义filter和偏置</span>
    conv2_w<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conv2_b<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#卷积层</span>
    conv2_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>pool1_x<span class="token punctuation">,</span>filter<span class="token operator">=</span>conv2_w<span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span><span class="token operator">+</span>conv2_b
    <span class="token comment" spellcheck="true">#激活层</span>
    relu2_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>conv2_x<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#池化层</span>
    pool2_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>value<span class="token operator">=</span>relu2_x<span class="token punctuation">,</span>ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#全连接层</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'full_connection'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#形状修改  reshape 没有None的用法，写-1  shape=[None,7*7*64] 错误</span>
    x_fc<span class="token operator">=</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>pool2_x<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    w_fc<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    b_fc<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    y_predict<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x_fc<span class="token punctuation">,</span>w_fc<span class="token punctuation">)</span><span class="token operator">+</span>b_fc

<span class="token comment" spellcheck="true">#3、softmax回归以及交叉熵损失计算</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">"softmax_crossentropy"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#labels:真实值 [None,10] one-hot</span>
    <span class="token comment" spellcheck="true">#logits:输出[None,10]</span>
    <span class="token comment" spellcheck="true">#返回每个样本的损失组成的列表</span>
    loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>softmax_cross_entropy_with_logits<span class="token punctuation">(</span>labels<span class="token operator">=</span>y_true<span class="token punctuation">,</span>logits<span class="token operator">=</span>y_predict<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#4、梯度下降优化损失</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'optimizer'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#学习率</span>
    train_op<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>AdamOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#5、得出每次训练的准确率（通过真实值和预测值进行位置比较，每个样本都比较）</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">"accuracy"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    equal_list<span class="token operator">=</span>tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>arg_max<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    accuracy<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>equal_list<span class="token punctuation">,</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#（2）收集要显示的变量</span>
<span class="token comment" spellcheck="true">#先收集损失和准确率</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">"losses"</span><span class="token punctuation">,</span>loss<span class="token punctuation">)</span>
tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>scalar<span class="token punctuation">(</span><span class="token string">"acc"</span><span class="token punctuation">,</span>accuracy<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#初始化变量op</span>
init_op<span class="token operator">=</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#（3）合并所有变量op</span>
merged<span class="token operator">=</span>tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>merge_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># #创建模型保存和加载</span>
<span class="token comment" spellcheck="true"># # saver=tf.train.Saver()</span>

<span class="token comment" spellcheck="true">#开启会话去训练</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#初始化变量</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init_op<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#（1）创建一个events文件实例</span>
    file_writer<span class="token operator">=</span>tf<span class="token punctuation">.</span>summary<span class="token punctuation">.</span>FileWriter<span class="token punctuation">(</span><span class="token string">'./tmp/summary/'</span><span class="token punctuation">,</span>graph<span class="token operator">=</span>sess<span class="token punctuation">.</span>graph<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># #加载模型</span>
    <span class="token comment" spellcheck="true"># if os.path.exists('./tmp/modelckpt/checkpoint'):</span>
    <span class="token comment" spellcheck="true">#     saver.restore(sess,'./tmp/modelckpt/fc_nn_model')</span>

    <span class="token keyword">if</span> FLAGS<span class="token punctuation">.</span>is_train<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">#循环步数去训练</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true">#获取数据，实时提供</span>
            <span class="token comment" spellcheck="true">#每步提供50个样本训练</span>
            mnist_x<span class="token punctuation">,</span>mnist_y<span class="token operator">=</span>mnist<span class="token punctuation">.</span>train<span class="token punctuation">.</span>next_batch<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#进行训练op</span>
            sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>train_op<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>mnist_x<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>mnist_y<span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练第%d步的准确率为：%f，损失为：%f"</span><span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
                                           sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>accuracy<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>mnist_x<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>mnist_y<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                           sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>loss<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>mnist_x<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>mnist_y<span class="token punctuation">}</span><span class="token punctuation">)</span>
                                                        <span class="token punctuation">)</span>
                 <span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">#运行合变量op，写入事件文件当中</span>
            summary<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>merged<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>mnist_x<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>mnist_y<span class="token punctuation">}</span><span class="token punctuation">)</span>
            file_writer<span class="token punctuation">.</span>add_summary<span class="token punctuation">(</span>summary<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true"># if i %100 ==0:</span>
            <span class="token comment" spellcheck="true">#     saver.save(sess,'./tmp/modelckpt/fc_nn_model')</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment" spellcheck="true">#如果不是训练，我们就去进行预测测试集数据</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true">#每次拿一个样本预测</span>
            mnist_x<span class="token punctuation">,</span>mnist_y<span class="token operator">=</span>mnist<span class="token punctuation">.</span>test<span class="token punctuation">.</span>next_batch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第%d个样本的真实值为：%d，模型预测结果为：%d"</span><span class="token operator">%</span><span class="token punctuation">(</span>
                i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
                tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>mnist_x<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>mnist_y<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>mnist_x<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>mnist_y<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>c、网络的优化和改进：</p>
<p>  1、学习率   2、随机初始化的权重、偏置的值（加了标准方差）3、选择好用的优化器  4、调整网络结构(加层)</p>
<p>d、常用网络模型 GoogleNet  ResNet</p>
<p>4）实战：验证码图片识别</p>
<p>a、原理分析：</p>
<p><img src="D:\Machine learning\深度学习image\原理分析.png" alt=""></p>
<p>一个样本对应四个目标值，切割的方式不具备通用性，</p>
<p><img src="D:\Machine learning\深度学习image\转.png" alt=""></p>
<p>将字母根据在字母表的位置转为数字，在进行ont-hot编码：</p>
<p><img src="D:\Machine learning\深度学习image\转1.png" alt=""></p>
<p>b、衡量损失：</p>
<p><strong>softmax 交叉熵只适合一个样本对应一个目标值的分类，</strong></p>
<p><strong>而对于一个样本有多个目标值的分类可以用sigmoid交叉熵计算损失。</strong></p>
<p>signmoid交叉熵损失函数：</p>
<p><strong>tf.nn.sigmoid_cross_entropy_with_logits(labels=None,logits=None,name=None)  返回损失值列表,在求平均就可以优化</strong></p>
<p>●labels：真实值，为one_hot编码形式，和logits一样的形状</p>
<p>●logits：logits值，输出层的加权计算结果</p>
<p>对真实值进行one_hot编码：</p>
<p><strong>tf.one_hot(indices,depth,axis=None,name=None)</strong> </p>
<p>●indices：需要编码的张量</p>
<p>●depth：one_hot编码的深度</p>
<p>●axis：填充的维度，默认是-1</p>
<p>c、准确率计算：</p>
<p>y_predict[None,4,26]</p>
<p>tf.argmax(y_predict,axis=2/-1)</p>
<p>tf.reduce_all() ：都为True返回True，有一个False，返回False</p>
<p>d、流程分析：</p>
<p>1、读取图片数据    filename —&gt;标签值</p>
<p><img src="D:\Machine learning\深度学习image\读取图片数据.png" alt=""></p>
<p>key,value=read(file_queue)</p>
<p>key：文件名 -labels.csv -目标值</p>
<p>value：一个样本的内容</p>
<p>2、解析csv文件，将标签值NZPP-&gt;[13,25,15,15]，建立文件名和标签值对应表格</p>
<p>3、将一个样本的特征值和目标值一一对应</p>
<p>4、构建卷积神经网络  —&gt;y_predict</p>
<p>5、构造损失函数</p>
<p>6、优化损失</p>
<p>7、计算准确率</p>
<p><img src="D:\Machine learning\深度学习image\计算准确率.png" alt=""></p>
<p>8、开启会话、开启线程</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token comment" spellcheck="true">#1、读取图片数据</span>
<span class="token comment" spellcheck="true"># 1)构造文件名队列</span>
<span class="token comment" spellcheck="true"># 获取文件名队列  *.jpg 是获取所有以jpg为后缀的图片</span>
file_names <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'./GenPics/*.jpg'</span><span class="token punctuation">)</span>
file_queue <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>string_input_producer<span class="token punctuation">(</span>file_names<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 2)读取与解码</span>
<span class="token comment" spellcheck="true"># 读取阶段</span>
reader <span class="token operator">=</span> tf<span class="token punctuation">.</span>WholeFileReader<span class="token punctuation">(</span><span class="token punctuation">)</span>
filename<span class="token punctuation">,</span> image <span class="token operator">=</span> reader<span class="token punctuation">.</span>read<span class="token punctuation">(</span>file_queue<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 解码阶段</span>
decoded <span class="token operator">=</span> tf<span class="token punctuation">.</span>image<span class="token punctuation">.</span>decode_jpeg<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#更新形状，将图片形状确定下来</span>
decoded<span class="token punctuation">.</span>set_shape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#修改图片类型</span>
image_cast<span class="token operator">=</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>decoded<span class="token punctuation">,</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 3)批处理</span>
filename_batch<span class="token punctuation">,</span>image_batch<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>batch<span class="token punctuation">(</span>filename<span class="token punctuation">,</span>image_cast<span class="token punctuation">,</span>batch_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>num_threads<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>capacity<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#2、解析csv文件，将标签值NZPP->[13,25,15,15]，建立文件名和标签值对应表格</span>
<span class="token comment" spellcheck="true">#读取文件</span>
csv_data<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./Genpics/labels.csv'</span><span class="token punctuation">,</span>names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'fiel_num'</span><span class="token punctuation">,</span><span class="token string">'chars'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>index_col<span class="token operator">=</span><span class="token string">'file_num'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#根据字母生成对应数字  NZPP-->[13,25,15,15]    ASIIC码：ord('N')-ord('A')=13</span>
labels<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> label <span class="token keyword">in</span> csv_data<span class="token punctuation">[</span><span class="token string">'chars'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    letter<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> word <span class="token keyword">in</span> label<span class="token punctuation">:</span>
        letter<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ord<span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token operator">-</span>ord<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>letter<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#将labels字段加到表格里</span>
csv_data<span class="token punctuation">[</span><span class="token string">'labels'</span><span class="token punctuation">]</span><span class="token operator">=</span>labels

<span class="token comment" spellcheck="true">#3、将一个样本的特征值和目标值一一对应</span>
labels1<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> file_name <span class="token keyword">in</span> filename<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#查看文件名是否有数字 filter得到的结果是生成器，不能直接用，所以加了list</span>
    file_num<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>list<span class="token punctuation">(</span>filter<span class="token punctuation">(</span>str<span class="token punctuation">.</span>isdight<span class="token punctuation">,</span>str<span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    target<span class="token operator">=</span>csv_data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>int<span class="token punctuation">(</span>file_num<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'labels'</span><span class="token punctuation">]</span>
    labels1<span class="token punctuation">.</span>append<span class="token punctuation">(</span>target<span class="token punctuation">)</span>
labels1<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>labels1<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#4、构建卷积神经网络  —>y_predict</span>
<span class="token comment" spellcheck="true">#（1）准备数据</span>
x<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span>None<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_true<span class="token operator">=</span>tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>int32<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span>None<span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#（2）构建模型</span>
<span class="token comment" spellcheck="true">#形状[None,20,80,3]</span>
<span class="token comment" spellcheck="true">#第一个卷积大层</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'conv1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment" spellcheck="true">#定义filter和偏置</span>
    conv1_w<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conv1_b<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#卷积层</span>
    conv1_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>input<span class="token operator">=</span>x<span class="token punctuation">,</span>filter<span class="token operator">=</span>conv1_w<span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span><span class="token operator">+</span>conv1_b
    <span class="token comment" spellcheck="true">#激活层</span>
    relu1_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>conv1_x<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#池化层</span>
    pool1_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>value<span class="token operator">=</span>relu1_x<span class="token punctuation">,</span>ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#第二个卷积大层  形状[None,20,80,3]--> [None,10,40,32]</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'conv2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#定义filter和偏置</span>
    conv2_w<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    conv2_b<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#卷积层</span>
    conv2_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>pool1_x<span class="token punctuation">,</span>filter<span class="token operator">=</span>conv2_w<span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span><span class="token operator">+</span>conv2_b
    <span class="token comment" spellcheck="true">#激活层</span>
    relu2_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>conv2_x<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#池化层</span>
    pool2_x<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>value<span class="token operator">=</span>relu2_x<span class="token punctuation">,</span>ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#全连接层  形状[None,10,40,32] --> [None，5，20，64]</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">'full_connection'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#reshape 没有None的用法，写-1  shape=[None,7*7*64] 错误</span>
    <span class="token comment" spellcheck="true">#形状修改 [None，5，20，64] --> [None,5*20*64]</span>
    <span class="token comment" spellcheck="true">#[None,5*20*64] *[5*20*64，26]=[None,4*26]</span>
    x_fc<span class="token operator">=</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>pool2_x<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">20</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    w_fc<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">20</span><span class="token operator">*</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    b_fc<span class="token operator">=</span>tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>initial_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    y_predict<span class="token operator">=</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>x_fc<span class="token punctuation">,</span>w_fc<span class="token punctuation">)</span><span class="token operator">+</span>b_fc
<span class="token comment" spellcheck="true">#（3）构造损失函数</span>
loss_list<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>sigmoid_cross_entropy_with_logits<span class="token punctuation">(</span>labels<span class="token operator">=</span>y_true<span class="token punctuation">,</span>logits<span class="token operator">=</span>y_predict<span class="token punctuation">)</span>
loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>loss_list<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#（4）优化损失</span>
optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>AdamOptimizer<span class="token punctuation">(</span>learning_rate<span class="token operator">=</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#（5）计算准确率</span>
equal_list<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_all<span class="token punctuation">(</span>
tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>y_true<span class="token punctuation">,</span>shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token number">1</span>
<span class="token punctuation">)</span>
accuracy<span class="token operator">=</span>tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>equal_list<span class="token punctuation">,</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">#初始化变量</span>
init<span class="token operator">=</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#开启会话</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true">#初始化变量</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>init<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#开启线程</span>
    coord<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Coordinator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    threads<span class="token operator">=</span>tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>start_queue_runners<span class="token punctuation">(</span>sess<span class="token operator">=</span>sess<span class="token punctuation">,</span>coord<span class="token operator">=</span>coord<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        filename_value<span class="token punctuation">,</span>image_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>filename<span class="token punctuation">,</span>image<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#将标签值转换成one-hot</span>
        labels_value<span class="token operator">=</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>one_hot<span class="token punctuation">(</span>labels<span class="token punctuation">,</span>depth<span class="token operator">=</span><span class="token number">26</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">26</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token punctuation">)</span>

        _<span class="token punctuation">,</span>error<span class="token punctuation">,</span>accuracy_value<span class="token operator">=</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>optimizer<span class="token punctuation">,</span>loss<span class="token punctuation">,</span>accuracy<span class="token punctuation">]</span><span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{</span>x<span class="token punctuation">:</span>image_value<span class="token punctuation">,</span>y_true<span class="token punctuation">:</span>labels_value<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第%d次训练后损失为：%f,准确率为%f"</span><span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>error<span class="token punctuation">,</span>accuracy_value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">#回收线程</span>
    coord<span class="token punctuation">.</span>request_stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coord<span class="token punctuation">.</span>join<span class="token punctuation">(</span>threads<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="7、以上内容总结："><a href="#7、以上内容总结：" class="headerlink" title="7、以上内容总结："></a><strong>7、以上内容总结：</strong></h4><p>​                                                1-1：神经网络结构：输入层、隐藏层、输出层</p>
<p>​                                                                           1-2-1：卷积层：大小、步长、数量、零填充通过平移卷积核提取特征</p>
<p>1、卷积神经网络的原理 –&gt;  1-2：隐藏层 –&gt;1-2-2：激活层：Relu   增加处理非线性问题的能力</p>
<p>​                                                                           1-2-3：池化层：最大池化、平均池化     减少模型参数，防止过拟合</p>
<p>​                                                 1-3：全连接层</p>
<p>​                      </p>
<p>2、设计网络解决问题 </p>

					
				</div>
			</div>
		</article>

		<ul class="am-pagination">
    
	
		<li class="am-pagination-next">
		<a class="pull-right" href="/2019/03/01/机器学习入门笔记/" title="">
			下一篇 &raquo;
		</a>
		</li>
	 
 </ul>
        

		<div class="theme-annie-comment-button-container">
	<button id="annie-comment-button" class="theme-annie-comment-button" onclick="Annie_Comment()">
		加载评论
		<!--加载评论-->
	</button>
</div>

<div id="annie-comment-container" class="theme-annie-comment-main-container">

	
		
			<!-- comment gitalk -->
			<!-- show gitalk comment -->

  <div id="gitalk-container"></div>


<!-- gitalk`s css & js -->
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<link rel="stylesheet" href="/css/comment.css">
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<script type="text/javascript">
	//thanks O-R
	//https://github.com/gitalk/gitalk/issues/102#issuecomment-382970552
	//去除尾部匹配正则数组的字符串  
	//remove redundant characters
	String.prototype.trimEnd = function(regStr) {
		var result = this;
		if(regStr == undefined || regStr == null || regStr == "") {
			return result;
		}
		var array = regStr.split(',');

		if(array.length > 0) {

			var c = array.shift();
			var str = this;
			var i = str.length;
			var rg = new RegExp(c);
			var matchArr = str.match(rg);

			if(matchArr != undefined && matchArr != null && matchArr.length > 0) {
				var matchStr = matchArr[0].replace(/\\/g, "\\\\").replace(/\*/g, "\\*")
					.replace(/\+/g, "\\+").replace(/\|/g, "\\|")
					.replace(/\{/g, "\\{").replace(/\}/g, "\\}")
					.replace(/\(/g, "\\(").replace(/\)/g, "\\)")
					.replace(/\^/g, "\\^").replace(/\$/g, "\\$")
					.replace(/\[/g, "\\[").replace(/\]/g, "\\]")
					.replace(/\?/g, "\\?").replace(/\,/g, "\\,")
					.replace(/\./g, "\\.").replace(/\&/g, "\\&");
				matchStr = matchStr + '$';
				result = str.replace(new RegExp(matchStr), "");
			}

			if(array.length > 0) {
				return result.trimEnd(array.join())
			} else {
				return result;
			}
		}
	};

	//create gitalk
	var gitalk = new Gitalk({
		clientID: 'b718a3924c38e43a46fd',
		clientSecret: 'a90fe88f7fdac55dfa97a7acfff4e73d3ccd7115',
		//id: window.location.pathname,
		// id: (window.location.pathname).split("/").pop().substring(0, 49),
		id: md5(location.href.trimEnd('#.*$,\\?.*$,index.html$')),
		repo: 'gitalk',
		owner: 'zhang666xin',
		admin: 'zhang666xin',
		distractionFreeMode: 'true',
	})
	gitalk.render('gitalk-container');
</script>
		
	

</div>

<script type="text/javascript">
	/* Show Comment */
	var Annie_Comment = function() {
		function Show_Hidden(obj) {
			obj.style.display = 'block';
		}
		
		//var obutton = $('#annie-comment-button');
		//var obutton = $('#annie-comment-container');
		var obutton = document.getElementById("annie-comment-button" || "0");
		var odiv = document.getElementById("annie-comment-container");
		if( 'obutton' ) {
			obutton.onclick = function() {
				Show_Hidden(odiv);
				$("#annie-comment-button").css("display", 'none');
				return false;
			}
		}
	};

	(function Annie_Init() {
		Annie_Comment();
	})();
</script>
		
		<!--
	时间：2018-09-24
	描述：The TOC module refers to 'https://github.com/codefine/hexo-theme-mellow', include toc.ejs、toc.js、toc.css. All rights reserved by codefine. 
-->

	
		<aside class="post-widget">
			<nav class="post-toc-wrap" id="post-toc">
				
					<strong>文章目录</strong>
				
				
				<!--toc(post.content)-->
				<ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#深度学习入门："><span class="post-toc-text">深度学习入门：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#1、深度学习介绍："><span class="post-toc-text">1、深度学习介绍：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#2、TensorFlow框架的使用："><span class="post-toc-text">2、TensorFlow框架的使用：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#图：定义数据和操作的步骤"><span class="post-toc-text">图：定义数据和操作的步骤</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#会话：调用各方资源，将定义好的数据和操作运行起来"><span class="post-toc-text">会话：调用各方资源，将定义好的数据和操作运行起来</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#张量：数据（tensor）"><span class="post-toc-text">张量：数据（tensor）</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#变量OP：存储模型参数"><span class="post-toc-text">变量OP：存储模型参数</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#节点（OP）：操作"><span class="post-toc-text">节点（OP）：操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3、以上内容总结："><span class="post-toc-text">3、以上内容总结：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#4、数据读取、神经网络："><span class="post-toc-text">4、数据读取、神经网络：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#5、以上内容总结："><span class="post-toc-text">5、以上内容总结：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#6、卷积神经网络："><span class="post-toc-text">6、卷积神经网络：</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#7、以上内容总结："><span class="post-toc-text">7、以上内容总结：</span></a></li></ol></li></ol></li></ol></li></ol>
			</nav>
			<div class="post-toc-bar"><div>
		</aside>
	

	</div>
</div>
		</div>
		</main>
		
		<!--footer-->
		<footer>
	<div class="blog-text-center">
		<div class="theme-annie-social">
				
				
					<a href="http://github.com/" title="Github" target="_blank"><i class="fa fa-github"></i>&nbsp;</a>
					
				
					<a href="http://github.com/" title="Weibo" target="_blank"><i class="fa fa-weibo"></i>&nbsp;</a>
				
				
					<a href="http://github.com/" title="Email" target="_blank"><i class="fa fa-envelope-o"></i>&nbsp;</a>
					
				
					<a href="http://github.com/" title="QQ" target="_blank"><i class="fa fa-qq"></i>&nbsp;</a>
					
				
					<a href="http://github.com/" title="Twitter" target="_blank"><i class="fa fa-twitter"></i>&nbsp;</a>
						
				
		</div>
	</div>

	<div  class="blog-text-center">
		<div class="theme-annie-copyright">
			
				&copy; 2017 - 2019, content by Mr.zx. All Rights Reserved.			       	
			
		</div>
	</div>

	<div class="blog-text-center">
		<div class="theme-annie-copyright">
			<a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> Theme <a href="https://github.com/Sariay/hexo-theme-Annie" title="Annie" target="_blank" rel="noopener">Annie</a> by Sariay.		
		</div>
	</div>
</footer>
		<!-- <script src="http://code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script> -->

<script>
	window.jQuery || document.write('<script src="/js/jquery-2.1.1.min.js"><\/script>')
</script>

<style>
	.motto {
		color: #000000;
		font-size: 20px;
		margin: 100px 25% 0;
		width: 50%;
		line-height: 1.4;
		font-family:"KaiTi", "STXingkai", "Source Sans Pro", "Segoe UI", "Lucida Grande", Helvetica, Arial, "Microsoft YaHei", FreeSans, Arimo, "Droid Sans", "wenquanyi micro hei", "Hiragino Sans GB", "Hiragino Sans GB W3", FontAwesome, sans-serif;
		text-align: center;
	}
	@media(max-width: 890px) {
		.motto {	
			margin: 100px 10% 0;
			width: 80%;
		}
	}
	@media(max-width: 890px) {
		.motto {
			margin: 100px 5% 0;
			width: 90%;
		}
	}
</style>


	<script src="/js/motto.js"></script>
	<script type="text/javascript">
		$(".motto").html(getMingYanContent());
	</script>	



	<div class="popup search-popup local-search-popup">
    <span class="popup-btn-close">
      ESC
    </span>
    <div class="container">
      <div class="col-md-8 col-md-offset-2">

        <div class="local-search-header clearfix">
            <span class="search-icon"></span>
            <div class="local-search-input-wrapper">
              <input autocomplete="off" placeholder="Search..." type="text" id="local-search-input">
            </div>
        </div>

        <div id="local-search-result"></div>

      </div>
    </div>
</div>

<script src="/js/ziploader.js"></script>


  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.json";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').fadeOut(300);
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $('.popup').fadeIn(300);
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // get search zip version
    $.get('/searchVersion.txt?t=' + (+new Date()), function(res) {
      if (localStorage.getItem('searchVersion') !== res) {
        localStorage.setItem('searchVersion', res);
        initSearchJson();
      }
    });

    function initSearchJson () {
      initLoad(['/search.zip'], {
        loadOptions: {
          success: function(obj) {
            localStorage.setItem('searchJson', obj['search.json'])
          },
          error: function(e) {
            return console.log(e)
          }
        },
        returnOptions: {
          'json': TYPE_TEXT
        },
        mimeOptions:{
          'json':'application/json'
        }
      })
    }

    // search function;
    var searchFunc = function(search_id, content_id) {
      'use strict';

      isfetched = true;
      var datas = JSON.parse(localStorage.getItem('searchJson'));
      console.log(search_id)
      var input = document.getElementById(search_id);
      var resultContent = document.getElementById(content_id);
      var inputEventFunction = function() {
        var searchText = input.value.trim().toLowerCase();
        var keywords = searchText.split(/[\s\-]+/);
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        var resultItems = [];
        if (searchText.length > 0) {
          // perform local searching
          datas.forEach(function(data) {
            var isMatch = false;
            var hitCount = 0;
            var searchTextCount = 0;
            var title = data.title ? data.title.trim() : '';
            var titleInLowerCase = title.toLowerCase();
            var content = data.content ? data.content.trim().replace(/<[^>]+>/g,"") : '';
            var contentInLowerCase = content.toLowerCase();
            var articleUrl = decodeURIComponent(data.url);
            var indexOfTitle = [];
            var indexOfContent = [];
            // only match articles with not empty titles
            keywords.forEach(function(keyword) {
              function getIndexByWord(word, text, caseSensitive) {
                var wordLen = word.length;
                if (wordLen === 0) {
                  return [];
                }
                var startPosition = 0, position = [], index = [];
                if (!caseSensitive) {
                  text = text.toLowerCase();
                  word = word.toLowerCase();
                }
                while ((position = text.indexOf(word, startPosition)) > -1) {
                  index.push({position: position, word: word});
                  startPosition = position + wordLen;
                }
                return index;
              }

              indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
              indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
            });
            if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
              isMatch = true;
              hitCount = indexOfTitle.length + indexOfContent.length;
            }

            // show search results

            if (isMatch) {
              // sort index by position of keyword

              [indexOfTitle, indexOfContent].forEach(function (index) {
                index.sort(function (itemLeft, itemRight) {
                  if (itemRight.position !== itemLeft.position) {
                    return itemRight.position - itemLeft.position;
                  } else {
                    return itemLeft.word.length - itemRight.word.length;
                  }
                });
              });

              // merge hits into slices

              function mergeIntoSlice(text, start, end, index) {
                var item = index[index.length - 1];
                var position = item.position;
                var word = item.word;
                var hits = [];
                var searchTextCountInSlice = 0;
                while (position + word.length <= end && index.length != 0) {
                  if (word === searchText) {
                    searchTextCountInSlice++;
                  }
                  hits.push({position: position, length: word.length});
                  var wordEnd = position + word.length;

                  // move to next position of hit

                  index.pop();
                  while (index.length != 0) {
                    item = index[index.length - 1];
                    position = item.position;
                    word = item.word;
                    if (wordEnd > position) {
                      index.pop();
                    } else {
                      break;
                    }
                  }
                }
                searchTextCount += searchTextCountInSlice;
                return {
                  hits: hits,
                  start: start,
                  end: end,
                  searchTextCount: searchTextCountInSlice
                };
              }

              var slicesOfTitle = [];
              if (indexOfTitle.length != 0) {
                slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
              }

              var slicesOfContent = [];
              while (indexOfContent.length != 0) {
                var item = indexOfContent[indexOfContent.length - 1];
                var position = item.position;
                var word = item.word;
                // cut out 100 characters
                var start = position - 20;
                var end = position + 80;
                if(start < 0){
                  start = 0;
                }
                if (end < position + word.length) {
                  end = position + word.length;
                }
                if(end > content.length){
                  end = content.length;
                }
                slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
              }

              // sort slices in content by search text's count and hits' count

              slicesOfContent.sort(function (sliceLeft, sliceRight) {
                if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                  return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                  return sliceRight.hits.length - sliceLeft.hits.length;
                } else {
                  return sliceLeft.start - sliceRight.start;
                }
              });

              // select top N slices in content

              var upperBound = parseInt('2');
              if (upperBound >= 0) {
                slicesOfContent = slicesOfContent.slice(0, upperBound);
              }

              // highlight title and content

              function highlightKeyword(text, slice) {
                var result = '';
                var prevEnd = slice.start;
                slice.hits.forEach(function (hit) {
                  result += text.substring(prevEnd, hit.position);
                  var end = hit.position + hit.length;
                  result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                  prevEnd = end;
                });
                result += text.substring(prevEnd, slice.end);
                return result;
              }

              var resultItem = '';

              if (slicesOfTitle.length != 0) {
                resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
              } else {
                resultItem += "<li><a target='_blank' href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
              }

              slicesOfContent.forEach(function (slice) {
                resultItem +=  "<p class=\"search-result\">" + highlightKeyword(content, slice) + "...</p>";
              });

              resultItem += "</li>";
              resultItems.push({
                item: resultItem,
                searchTextCount: searchTextCount,
                hitCount: hitCount,
                id: resultItems.length
              });
            }
          })
        };
        if (keywords.length === 1 && keywords[0] === "") {
          resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
        } else if (resultItems.length === 0) {
          resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /> no result </div>'
        } else {
          resultItems.sort(function (resultLeft, resultRight) {
            if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
              return resultRight.searchTextCount - resultLeft.searchTextCount;
            } else if (resultLeft.hitCount !== resultRight.hitCount) {
              return resultRight.hitCount - resultLeft.hitCount;
            } else {
              return resultRight.id - resultLeft.id;
            }
          });
          var searchResultList = '<ul class=\"search-result-list\">';
          resultItems.forEach(function (result) {
            searchResultList += result.item;
          })
          searchResultList += "</ul>";
          resultContent.innerHTML = searchResultList;
        }
      }

      if ('auto' === 'auto') {
        input.addEventListener('input', inputEventFunction);
      } else {
        $('.search-icon').click(inputEventFunction);
        input.addEventListener('keypress', function (event) {
          if (event.keyCode === 13) {
            inputEventFunction();
          }
        });
      }

      // remove loading animation
      $('body').css('overflow', '');

      proceedsearch();
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        $('.sb-close').click();
        searchFunc('local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





	<script type="text/javascript" src="/js/love.js"></script>



	<script type="text/javascript" src="/js/toc.js"></script>


<script type="text/javascript" src="/js/main.js"></script>

<script type="text/javascript">
	//generate a random img that pre_name 'from 0 to 110'
	var random_bg = Math.floor(Math.random() * 109 + 1);

	//var bg = 'url(/img/random/' + random_bg + '.jpg)';		
	var bg = 'url(https://zhang666xin.github.io/Random-img/' + random_bg + '.jpg)';

	$("#header-bg-2").css("background-image", bg);
</script>
<div style="position:absolute; bottom:120px; left:36px;width:76%;">
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=41500546&auto=1&height=66"></iframe>
</div>
		
		<!--back to top-->
        <style type="text/css">
	#totop {
		background: white;
		border-radius: 50%;
		position: fixed;
		right: 5.4%;
		bottom: 80px;
		cursor: pointer;
	}
	
	#totop a {
		color: #474747;
		background-color: transparent;
		padding: 10px;
		text-decoration: none;
	}
	
	@media(max-width:512px) {
		#totop {
			display: none;
			visibility: hidden;
		}
	}
</style>


	<div id="totop">
  		<a href="javascript:;" class="fa fa-arrow-up"></a>
	</div>

	<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
	</html>

